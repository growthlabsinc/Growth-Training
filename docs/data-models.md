# Growth App Data Models

This document outlines the core data models used in the Growth app for storing and retrieving data from Firebase Firestore.

## Overview

The Growth app uses the following main data models:

1. **User**: Represents app users with their settings and preferences
2. **GrowthMethod**: Contains information about different growth methods/techniques
3. **SessionLog**: Records user training sessions
4. **EducationalResource**: Stores educational content for users

All models are implemented using Swift's Codable protocol for serialization/deserialization with Firestore.

## Data Models

### User Model

The User model stores information about each registered user.

#### Firestore Path
`users/{userId}`

#### Fields
- `userId` (String): Unique identifier for the user (Firebase Auth UID)
- `creationDate` (Timestamp): When the user account was created
- `lastLogin` (Timestamp): When the user last logged in
- `linkedProgressData` (Map, Optional): Any linked progress data for this user
- `settings` (Map): User settings and preferences
  - `notificationsEnabled` (Boolean): Whether push notifications are enabled
  - `reminderTime` (Timestamp, Optional): Time for daily reminders if enabled
  - `privacyLevel` (String): Privacy level setting (`high`, `medium`, or `low`)

#### Swift Implementation
```swift
struct User: Codable, Identifiable {
    let id: String
    let creationDate: Date
    let lastLogin: Date
    let linkedProgressData: [String: String]?
    let settings: UserSettings
}

struct UserSettings: Codable {
    let notificationsEnabled: Bool
    let reminderTime: Date?
    let privacyLevel: PrivacyLevel
}

enum PrivacyLevel: String, Codable {
    case high
    case medium
    case low
}
```

#### Security Considerations
- Users can only read and write their own user document
- Privacy level controls what data is collected and shared

### GrowthMethod Model

The GrowthMethod model represents techniques and exercises available in the app.

#### Firestore Path
`growthMethods/{methodId}`

#### Fields
- `methodId` (String): Unique identifier for the method (auto-generated by Firestore or custom)
- `stage` (Number): Stage or progression level of the method
- `title` (String): Title of the growth method
- `description` (String): Brief description of the method (replaces `methodDescription`)
- `instructions_text` (String): Detailed instructions for performing the method
- `visual_placeholder_url` (String, Optional): URL for an image/video placeholder
- `categories` (Array of Strings): Categories or tags this method belongs to
- `equipment_needed` (Array of Strings, Optional): List of equipment needed
- `progression_criteria` (String, Optional): Criteria for progressing to next stage
- `safety_notes` (String, Optional): Important safety considerations
- `estimated_duration_minutes` (Number, Optional): Estimated time to complete (in minutes)
- `benefits` (Array of Strings, Optional): List of benefits of this method
- `related_methods` (Array of Strings, Optional): IDs of related GrowthMethods
- `isFeatured` (Boolean): Flag to indicate if this entry should be featured
- `createdAt` (Timestamp): Creation date of the entry
- `updatedAt` (Timestamp): Last update date of the entry
- `timerConfig` (Map, Optional): Configuration for the in-app timer. **(New for 7.2)**
  - `recommended_duration_seconds` (Number, Optional): The recommended exercise duration in seconds.
  - `is_countdown` (Boolean, Optional): Whether to count down (true) or up/stopwatch (false). Defaults to false if not set.
  - `has_intervals` (Boolean, Optional): Whether this method has interval-based timing. Defaults to false.
  - `intervals` (Array of Maps, Optional): List of interval configurations if `has_intervals` is true.
    - Each interval map: `{ name: String, duration_seconds: Number }`
  - `max_recommended_duration_seconds` (Number, Optional): Maximum recommended duration for safety alerts.

#### Swift Implementation
```swift
// Note: The actual implementation is a class conforming to NSObject, NSSecureCoding as well.
// This is a simplified struct representation for brevity.
struct GrowthMethod: Codable, Identifiable, Hashable {
    @DocumentID var id: String?
    var stage: Int
    var title: String
    var description: String
    var instructionsText: String
    var visualPlaceholderUrl: String?
    var categories: [String]? // Changed from [String] to [String]? to match other optionals
    var equipmentNeeded: [String]?
    var progressionCriteria: String?
    var safetyNotes: String?
    var estimatedDurationMinutes: Int?
    var benefits: [String]?
    var relatedMethods: [String]?
    var isFeatured: Bool? // Assuming this might be optional too
    var createdAt: Timestamp? // Assuming these are Timestamps
    var updatedAt: Timestamp?
    var timerConfig: TimerConfiguration? // Added for Story 7.2
}

struct TimerConfiguration: Codable, Hashable {
    var recommendedDurationSeconds: Int?
    var isCountdown: Bool?
    var hasIntervals: Bool?
    var intervals: [MethodInterval]?
    var maxRecommendedDurationSeconds: Int?
}

struct MethodInterval: Codable, Hashable, Identifiable {
    var id = UUID() // For SwiftUI, not stored in Firestore
    var name: String
    var durationSeconds: Int
}
```

#### Security Considerations
- Read-only for authenticated users
- Only administrators can create or modify methods

### SessionLog Model

The SessionLog model records information about user training sessions.

#### Firestore Path
`sessionLogs/{logId}` or `users/{userId}/sessionLogs/{logId}`

#### Fields
- `logId` (String): Unique identifier for the log
- `userId` (String): ID of the user who created this log
- `methodId` (String): ID of the growth method used
- `startTime` (Timestamp): When the session started
- `duration` (Number): Duration of the session in seconds
- `userNotes` (String, Optional): User's notes about the session
- `moodBefore` (String): User's mood before the session
- `moodAfter` (String): User's mood after the session

#### Swift Implementation
```swift
struct SessionLog: Codable, Identifiable {
    let id: String
    let userId: String
    let methodId: String
    let startTime: Date
    let duration: TimeInterval
    let userNotes: String?
    let moodBefore: Mood
    let moodAfter: Mood
}

enum Mood: String, Codable {
    case veryNegative = "very_negative"
    case negative = "negative"
    case neutral = "neutral"
    case positive = "positive"
    case veryPositive = "very_positive"
}
```

#### Security Considerations
- Users can only access their own session logs
- Mood data is stored as enumerated values rather than free text for privacy
- Session logs are stored with user ID reference for access control

### EducationalResource Model

The EducationalResource model stores educational content for users.

#### Firestore Path
`educationalResources/{resourceId}`

#### Fields
- `resourceId` (String): Unique identifier for the resource
- `title` (String): Title of the resource
- `content_text` (String): Main content of the resource
- `category` (String): Category of the resource
- `visual_placeholder_url` (String, Optional): URL for an image placeholder

#### Swift Implementation
```swift
struct EducationalResource: Codable, Identifiable {
    let id: String
    let title: String
    let contentText: String
    let category: ResourceCategory
    let visualPlaceholderUrl: String?
}

enum ResourceCategory: String, Codable {
    case basics = "basics"
    case technique = "technique"
    case science = "science"
    case safety = "safety"
    case progression = "progression"
}
```

#### Security Considerations
- Read-only for authenticated users
- Only administrators can create or modify resources

## Firestore Security Rules

Security rules have been implemented to enforce access controls:

1. Users can only read and write their own user data and session logs
2. Growth methods and educational resources are read-only for authenticated users
3. Default deny for all other access

## Data Privacy Considerations

1. Session logs store mood as enumerated values rather than free text
2. User privacy level setting controls data collection and sharing
3. Personal information is minimized in all models
4. Session logs can be stored as subcollections under user documents for easier GDPR compliance 