# Story 25.1: App Store Connect Configuration

## Story
**As a** product owner  
**I want to** create and configure the app in App Store Connect  
**So that** we can submit builds and manage releases  

## Description
Set up the initial App Store Connect configuration for the Growth app, including creating the app record, configuring basic information, setting up in-app purchases for the three subscription tiers, and enabling TestFlight for beta testing.

## Acceptance Criteria
- [ ] App record created in App Store Connect with bundle ID `com.growthlabs.growthmethod`
- [ ] Basic app information configured (name, subtitle, category)
- [ ] All three subscription tiers created as in-app purchases
- [ ] App Store Connect API key generated for automation
- [ ] TestFlight enabled with internal testing group created
- [ ] App privacy details configured
- [ ] Initial app metadata populated

## Technical Details

### Prerequisites
- Apple Developer account with Admin access
- Team ID: 62T6J77P6R
- Bundle ID: com.growthlabs.growthmethod

### App Store Connect Configuration

#### 1. Create New App
```
Platform: iOS
App Name: Growth
Primary Language: English (U.S.)
Bundle ID: com.growthlabs.growthmethod
SKU: GROWTH2025
```

#### 2. App Information
```
Category:
- Primary: Health & Fitness
- Secondary: Lifestyle

Age Rating: 17+
- Infrequent/Mild Sexual Content and Nudity

Content Rights:
- Does not contain third-party content
- Does not use third-party encryption
```

#### 3. In-App Purchase Products

**Basic Tier**
```
Reference Name: Growth Basic Monthly
Product ID: com.growthlabs.growthmethod.basic_monthly
Type: Auto-Renewable Subscription
Price: Tier 5 ($4.99 USD)
Subscription Duration: 1 Month
Family Sharing: Enabled
```

**Premium Tier**
```
Reference Name: Growth Premium Monthly
Product ID: com.growthlabs.growthmethod.premium_monthly
Type: Auto-Renewable Subscription
Price: Tier 10 ($9.99 USD)
Subscription Duration: 1 Month
Family Sharing: Enabled
```

**Elite Tier**
```
Reference Name: Growth Elite Monthly
Product ID: com.growthlabs.growthmethod.elite_monthly
Type: Auto-Renewable Subscription
Price: Tier 20 ($19.99 USD)
Subscription Duration: 1 Month
Family Sharing: Enabled
```

#### 4. Subscription Group
```
Group Name: Growth Membership
Group Reference Name: growth_membership
Upgrade/Downgrade/Crossgrade Rules: Standard
```

#### 5. App Store Server Notifications
```
Production URL: https://us-central1-growth-70a85.cloudfunctions.net/handleAppStoreNotification
Sandbox URL: https://us-central1-growth-70a85.cloudfunctions.net/handleAppStoreNotificationSandbox
Version: Version 2
```

### TestFlight Configuration

#### Internal Testing
```
Group Name: Growth Development Team
Testers: Add team developers
Enable automatic distribution
```

#### Beta App Information
```
Beta App Description: Test the latest features of Growth
Email: beta@growth-app.com
Privacy Policy URL: https://growth-app.com/privacy
License Agreement: Standard
```

### App Privacy Configuration

#### Data Collection
- [x] Email Address (App functionality, Linked to user)
- [x] Health & Fitness (App functionality, Linked to user)
- [x] User Content (App functionality, Linked to user)
- [x] Product Interaction (Analytics, Linked to user)
- [x] Crash Data (App functionality, Not linked to user)
- [x] Performance Data (Analytics, Not linked to user)

#### Data Use
- App Functionality
- Analytics
- No data used for tracking
- No data shared with third parties

### API Key Generation

#### Required Permissions
- App Manager (for app metadata)
- Developer (for TestFlight)
- Sales and Finance (for subscription data)

#### Key Configuration
```bash
# Store these securely - DO NOT commit to repo
APP_STORE_CONNECT_KEY_ID="YOUR_KEY_ID"
APP_STORE_CONNECT_ISSUER_ID="YOUR_ISSUER_ID"
APP_STORE_CONNECT_PRIVATE_KEY_PATH="./AuthKey_YOUR_KEY_ID.p8"
```

## Implementation Steps

### Step 1: Create App Record
1. Log into App Store Connect
2. Navigate to My Apps → "+" → New App
3. Select iOS platform
4. Enter app information
5. Create app

### Step 2: Configure Subscriptions
1. Navigate to app → Features → In-App Purchases
2. Click "+" to create subscription group
3. Add each subscription tier
4. Configure pricing for each territory
5. Add localized descriptions

### Step 3: Set Up TestFlight
1. Navigate to TestFlight tab
2. Create internal testing group
3. Add team members
4. Configure beta app information
5. Enable automatic updates

### Step 4: Configure App Privacy
1. Navigate to App Privacy section
2. Complete privacy questionnaire
3. Select all applicable data types
4. Indicate data usage
5. Publish privacy details

### Step 5: Generate API Keys
1. Navigate to Users and Access → Keys
2. Generate new key with required permissions
3. Download .p8 file
4. Store credentials securely

## Validation Checklist
- [ ] Can access app in App Store Connect
- [ ] All subscription products visible
- [ ] TestFlight shows as available
- [ ] Privacy details published
- [ ] API key works with test script
- [ ] Server notification URLs configured

## Dependencies
- Active Apple Developer membership
- Admin access to App Store Connect
- Firebase webhook endpoints deployed

## Security Considerations
- Store API keys in secure location
- Never commit credentials to Git
- Use environment variables for production
- Rotate keys periodically

## Notes
- Subscription prices may vary by territory
- App review may require demo account
- TestFlight builds expire after 90 days
- Keep subscription descriptions clear and accurate

## Definition of Done
- App visible in App Store Connect
- All subscriptions configured and ready
- TestFlight enabled for testing
- API access working
- Privacy configuration complete
- Documentation updated with app details