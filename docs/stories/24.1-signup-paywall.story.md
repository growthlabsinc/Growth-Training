# Story 24.1: Signup Paywall Flow

## Story
**As a** new user  
**I want to** see subscription options during signup  
**So that** I can start a trial or skip for later  

## Description
Implement a skippable paywall that appears after user authentication during the signup flow. This paywall should present subscription options with a clear "Start 5-Day Free Trial" CTA and a "Skip for Now" option to continue without subscribing.

## Acceptance Criteria
- [ ] Paywall appears after successful email/social authentication
- [ ] Paywall displays all three tiers with pricing
- [ ] "Start 5-Day Free Trial" button is prominent
- [ ] "Skip for Now" link allows bypassing
- [ ] User's choice is tracked in analytics
- [ ] Trial start date is set when trial begins
- [ ] Smooth transition to main app after choice
- [ ] Paywall doesn't show for returning users

## Technical Implementation

### 1. Signup Flow Integration
```swift
// In AuthViewModel after successful signup
func completeSignup() async {
    // Create user document
    await createUserDocument()
    
    // Check if first time user
    if !user.hasSeenSignupPaywall {
        // Show paywall
        showSignupPaywall = true
    } else {
        // Direct to main app
        navigateToMainApp()
    }
}
```

### 2. SignupPaywallView Component
```swift
struct SignupPaywallView: View {
    @StateObject private var viewModel = PaywallViewModel()
    @Binding var isPresented: Bool
    let onStartTrial: () -> Void
    let onSkip: () -> Void
    
    var body: some View {
        VStack {
            // Header
            PaywallHeader(
                title: "Unlock Your Full Potential",
                subtitle: "Start your 5-day free trial"
            )
            
            // Pricing cards
            SubscriptionTierCards(
                tiers: SubscriptionTier.allCases,
                selectedTier: $viewModel.selectedTier
            )
            
            // CTA Buttons
            VStack(spacing: 16) {
                PrimaryButton(
                    title: "Start 5-Day Free Trial",
                    action: handleStartTrial
                )
                
                Button("Skip for Now") {
                    handleSkip()
                }
                .foregroundColor(.secondary)
            }
        }
    }
}
```

### 3. Trial Initialization
```swift
func startFreeTrial(tier: SubscriptionTier) async {
    // Update user document
    try await userService.updateUser([
        "trialStartDate": Date(),
        "hasSeenSignupPaywall": true,
        "selectedTrialTier": tier.rawValue
    ])
    
    // Track analytics
    Analytics.logEvent("trial_started", parameters: [
        "source": "signup_paywall",
        "tier": tier.rawValue
    ])
    
    // Initialize subscription state
    SubscriptionStateManager.shared.startTrial(tier: tier)
}
```

## UI/UX Requirements
- Clean, non-aggressive design
- Clear value proposition messaging
- Pricing clearly visible
- Trial terms displayed
- Skip option visible but not prominent
- Smooth animations/transitions

## Analytics Events
- `signup_paywall_shown`
- `trial_started` (with tier)
- `signup_paywall_skipped`
- `tier_selected` (when user taps different tier)

## Testing Checklist
- [ ] New user sees paywall after signup
- [ ] Existing user doesn't see paywall
- [ ] Trial starts correctly with date tracking
- [ ] Skip option works properly
- [ ] Analytics events fire correctly
- [ ] UI works on all device sizes
- [ ] No crashes or errors in flow