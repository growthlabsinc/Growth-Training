# Story 15.3: Unify Practice Entry Points & Initial Routine Selection Flow

**Status:** In-Progress

## Goal & Context

**User Story:** As a User, I want clear and distinct ways to start either a structured routine session or an ad-hoc quick practice, and easily select or browse routines.

**Context:** This story builds upon the revised Information Architecture (Story 15.1) and Today View dashboard (Story 15.2) by integrating existing functional views into the new Practice and Routines tabs. The app already has substantial functionality including RoutineDetailView, RoutinesListView, DailyRoutineView, TimerView, LogSessionView, and comprehensive progress tracking (GrowthProgressView). Currently, these exist as separate views but need to be properly integrated into the new tab structure with enhanced navigation and user experience.

## Detailed Requirements

- **Unified Practice Entry:**
  - Ensure the "Practice" tab/section clearly offers options for "Guided Sessions (from my routine)" and "Quick Practice (select any method)."
  - The Dashboard "Today's Focus" will also serve as a primary entry point for routine-based sessions.
- **Routine Section (Initial Setup):**
  - "Current Routine" (in Routines Tab): Displays the active routine's weekly overview and day-by-day breakdown (details in Epic 16). If no routine is active, prompts to browse.
  - "Browse Routines" (in Routines Tab): Allows users to view available programs (Beginner, Intermediate, Advanced placeholders). Implement basic list view. Detailed routine content in Epic 16.
  - "Routine History" (in Routines Tab): Placeholder for displaying past completed/attempted routines.
- Implement progressive disclosure for routine details to avoid overwhelming users.

## Acceptance Criteria (ACs)

- AC1: Clear pathways exist from the "Practice" tab and Dashboard to start either a routine session or a quick practice session.
- AC2: The "Routines" tab structure (Current, Browse, History) is implemented.
- AC3: Users can browse a list of placeholder routines categorized by difficulty.
- AC4: The "Current Routine" view shows an overview if a routine is active, or a prompt to select one.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

**Important:** This story focuses on INTEGRATION of existing functionality rather than recreation. The app already has comprehensive views for routines, timers, session logging, and progress tracking that are fully functional and well-designed. The goal is to properly integrate these into the new tab structure and enhance navigation flows.

- **Relevant Files:**

  - Files to Modify:
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Practice/Views/PracticeTabView.swift` (integrate with existing TimerView/LogSessionView)
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Routines/Views/CurrentRoutineView.swift` (integrate with existing RoutineDetailView functionality)
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Routines/Views/BrowseRoutinesView.swift` (integrate with existing RoutinesListView)

  - Files to Create:
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Practice/ViewModels/PracticeTabViewModel.swift`
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Practice/Components/PracticeOptionCardView.swift`

  - Existing Files to Integrate:
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Routines/Views/RoutinesListView.swift` (fully functional routine browser)
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Routines/Views/RoutineDetailView.swift` (comprehensive routine details)
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Routines/Views/DailyRoutineView.swift` (day-specific routine interface)
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Timer/Views/TimerView.swift` (complete timer functionality)
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/SessionLogging/Views/LogSessionView.swift` (session logging)
    - `/Users/tradeflowj/Desktop/Growth/Growth/Features/Progress/Views/ProgressView.swift` (comprehensive progress tracking)

- **Key Technologies:**

  - SwiftUI for UI implementation with NavigationStack integration
  - Combine for reactive data flow and state management
  - Firebase Auth for user context and authentication
  - FirebaseFirestore for routine data retrieval via existing RoutineService
  - Existing TimerView and LogSessionView integration

- **API Interactions / SDK Usage:**

  - Use existing RoutineService for fetching routines and user selection
  - Use existing RoutinesViewModel for routine state management
  - Use existing GrowthMethodService for method data when needed
  - Integrate with existing TimerView and LogSessionView navigation
  - Use existing UserService for routine selection persistence

- **UI/UX Notes:**

  - Maintain consistent visual design with AppTheme and AppColors established in existing views
  - Leverage existing CardView component and visual patterns from RoutinesListView and RoutineDetailView
  - Integrate with existing progressive disclosure patterns: RoutinesListView → RoutineDetailView → DailyRoutineView
  - Clear visual distinction between "Guided" (from routine) and "Quick" practice options
  - Use existing difficulty level badges/indicators from RoutinesListView for routine categorization
  - Implement empty states for users with no selected routine, directing to existing RoutinesListView
  - Provide clear call-to-action buttons that integrate with existing navigation patterns
  - **Note:** Substantial UI/UX patterns already exist in RoutinesListView, RoutineDetailView, DailyRoutineView, TimerView, and LogSessionView - focus on integration rather than recreation

- **Data Structures:**

  - Use existing Routine model for routine data
  - Use existing DaySchedule model for routine day information
  - Use existing RoutinesViewModel for routine selection state
  - Create PracticeOption enum: .guided, .quick for practice type selection
  - Use existing GrowthMethod model for method selection in quick practice

- **Environment Variables:**

  - No new environment variables needed for this story
  - Use existing Firebase configuration

- **Coding Standards Notes:**
  - Follow SwiftUI best practices for view composition and navigation
  - Use proper state management with @StateObject and @ObservedObject
  - Implement clear separation between view models and views
  - Use existing navigation patterns established in the app
  - Follow established naming conventions and file organization
  - Implement proper loading states and error handling

## Tasks / Subtasks

- [x] Enhance Practice Tab functionality
  - [x] Create PracticeTabViewModel for state management and method selection
  - [x] Create PracticeOptionCardView component for guided/quick practice options
  - [x] Update PracticeTabView to integrate with existing TimerView and LogSessionView
  - [x] Implement navigation to GrowthMethodsListView for method selection in quick practice
  - [x] Add integration with existing DailyRoutineView for guided practice
  - [x] Add proper loading states and user feedback
- [x] Implement Current Routine functionality
  - [x] Update CurrentRoutineView to integrate with existing RoutinesViewModel
  - [x] Display active routine overview using existing routine data structures
  - [x] Implement routine selection prompt that navigates to existing RoutinesListView
  - [x] Add weekly overview display with day-by-day breakdown using existing DaySchedule model
  - [x] Connect to existing RoutineDetailView for detailed routine information
  - [x] Integrate with existing DailyRoutineView for day-specific practice
- [ ] Enhance Browse Routines functionality
  - [ ] Update BrowseRoutinesView to integrate with existing RoutinesListView functionality
  - [ ] Leverage existing RoutinesViewModel for routine fetching and state management
  - [ ] Use existing routine card designs and difficulty level categorization
  - [ ] Integrate existing routine selection functionality with UserService
  - [ ] Connect to existing RoutineDetailView for progressive disclosure of routine details
- [ ] Update navigation integration
  - [ ] Ensure Dashboard Today's Focus navigates to Practice tab correctly
  - [ ] Implement proper back navigation from Timer/LogSession to Practice
  - [ ] Add navigation from Current Routine to Browse Routines
  - [ ] Test all navigation pathways work as expected
- [ ] Implement loading and error states
  - [ ] Add loading indicators for routine data fetching
  - [ ] Handle network errors gracefully with retry options
  - [ ] Provide appropriate empty states for new users
  - [ ] Add user feedback for routine selection actions

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:**
  - Test PracticeTabViewModel navigation logic for guided vs quick practice
  - Test CurrentRoutineViewModel routine display logic and empty states
  - Test BrowseRoutinesViewModel routine categorization and selection
  - Verify proper integration with existing RoutinesViewModel and RoutineService
  - Test routine filtering by difficulty level works correctly

- **Integration Tests:**
  - Test complete flow from Practice tab to existing TimerView/LogSessionView
  - Test routine selection flow from Browse to Current Routine using existing RoutinesListView
  - Test navigation from Dashboard Today's Focus to Practice tab
  - Test integration with existing DailyRoutineView for guided practice sessions
  - Verify data persistence when user selects new routine using existing services
  - Test navigation to existing RoutineDetailView from various entry points
  - Test offline/error scenarios with proper fallback handling

- **Manual/CLI Verification:**
  - Launch app and navigate to Practice tab, verify both guided and quick options integrate with existing views
  - Test routine selection flow: browse → select → current routine displays using existing RoutinesListView
  - Verify users with no routine see appropriate prompts and can browse existing routines
  - Test all navigation pathways from Dashboard to Practice to existing Timer/Logging functionality
  - Confirm existing routine categorization by difficulty level displays correctly in integrated views
  - Verify integration with existing RoutineDetailView for progressive disclosure
  - Test loading states and error handling across integrated functionality
  - Verify existing DailyRoutineView works properly when accessed from new navigation structure

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Any notes about implementation choices, difficulties, or follow-up needed}
- **Change Log:** {Track changes _within this specific story file_ if iterations occur}
  - Initial Draft - 2025-05-29
  - Major Revision - 2025-05-29: Updated to focus on integration of existing functionality (RoutinesListView, RoutineDetailView, DailyRoutineView, TimerView, LogSessionView, GrowthProgressView) rather than recreation