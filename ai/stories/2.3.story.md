# Story 2.3: Medical Disclaimer & Safety Information Presentation

**Status:** Ready

## Goal & Context

**User Story:** As a new User, I want to be presented with clear medical disclaimers and safety information before I can use the app, so that I understand the nature of the app and its limitations.

**Context:** After implementing account creation (Story 2.1) and login functionality (Story 2.2), we need to ensure users are properly informed about medical disclaimers and safety information before they can access the main features of the app. This is a critical component of the onboarding flow to protect both users and the company.

## Detailed Requirements

- Create a screen or series of screens to display the full medical disclaimer and critical safety warnings. (Content to be provided by Legal/Content team).
- User must explicitly acknowledge/accept this information to proceed (e.g., checkbox and "Agree & Continue" button).
- This flow must occur after account creation/login for new users, before accessing the main app.
- Record user's acceptance (timestamp, version of disclaimer accepted) in their Firestore user profile.

## Acceptance Criteria (ACs)

- AC1: Medical disclaimer and safety information are clearly displayed.
- AC2: User cannot proceed to the main app without acknowledging the disclaimer.
- AC3: Acceptance is recorded in the user's profile in Firestore.
- AC4: UI is clear, readable, and professional.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Create:
    - `Growth/Features/Onboarding/Views/DisclaimerView.swift`: Screen showing medical disclaimer and safety info
    - `Growth/Features/Onboarding/Models/DisclaimerVersion.swift`: Model for tracking disclaimer versions
    - `Growth/Features/Onboarding/Services/OnboardingService.swift`: Service for managing onboarding state

  - Files to Modify:
    - `Growth/Features/Authentication/ViewModels/AuthViewModel.swift`: Update to include onboarding state
    - `Growth/Core/Models/User.swift`: Add fields for storing disclaimer acceptance

- **Key Technologies:**

  - SwiftUI for UI components
  - Firebase Firestore for storing user acceptance data
  - Combine for reactive programming

- **Firebase Integration:**

  - Add fields to user document in Firestore:
    - `disclaimerAccepted`: Boolean
    - `disclaimerAcceptedTimestamp`: Timestamp
    - `disclaimerVersion`: String

- **UI/UX Notes:**

  - The disclaimer screen should include:
    - Clear title indicating this is a medical disclaimer
    - Scrollable text area containing the full disclaimer text
    - Checkbox for user acknowledgment with clear label
    - Primary button to proceed (disabled until checkbox is checked)
    - Back button to return to previous screen
  - Text should be well-formatted, with headings and paragraphs for readability
  - Consider using a card-based layout to visually separate different sections
  - Ensure text is readable on all device sizes (test on smallest supported iPhone)

- **Disclaimer Content:**
  For development purposes, use this placeholder content:

  ```
  MEDICAL DISCLAIMER AND SAFETY INFORMATION

  IMPORTANT: READ CAREFULLY BEFORE USING THE GROWTH APP

  1. NOT A SUBSTITUTE FOR PROFESSIONAL MEDICAL ADVICE

  The Growth app provides educational information and tools for self-improvement purposes only. The content in this app is not intended to be a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition.

  2. CONSULT HEALTHCARE PROVIDERS

  Before beginning any new exercise routine, mental practice, or health regimen suggested within this app, consult with appropriate healthcare providers, especially if you have any pre-existing physical or mental health conditions.

  3. ASSUMPTION OF RISK

  By using the Growth app, you understand and acknowledge that physical and mental exercises carry inherent risks. You assume full responsibility for your safety and well-being while using techniques described in this app.

  4. LIMITATIONS OF APP CONTENT

  Information provided through Growth is general in nature and not tailored to individual circumstances. Methods described may not be appropriate for everyone. Results vary by individual.

  5. EMERGENCY SITUATIONS

  This app is not designed to address emergency situations. If you experience a medical emergency or feel you may harm yourself or others, stop using the app immediately and call emergency services (911) or go to your nearest emergency room.

  6. MONITORING AND SELF-AWARENESS

  Pay close attention to how your body and mind respond to any practice. Discontinue use if you experience pain, dizziness, shortness of breath, or psychological distress.

  By checking the acknowledgment box below, you confirm that you have read, understood, and agree to these disclaimers and safety information.
  ```

- **Error Handling:**
  - If Firestore update fails, retry the operation and provide feedback to the user
  - Cache acceptance locally until confirmation of successful Firestore update

## Tasks / Subtasks

- [ ] Create DisclaimerVersion model
  - [ ] Define properties for version, content, and required fields
- [ ] Update User model
  - [ ] Add fields for tracking disclaimer acceptance
- [ ] Create OnboardingService
  - [ ] Implement methods to track and update onboarding state
  - [ ] Add method to record disclaimer acceptance in Firestore
- [ ] Build DisclaimerView
  - [ ] Create UI with scrollable disclaimer text
  - [ ] Implement checkbox for user acknowledgment 
  - [ ] Add "Agree & Continue" button
  - [ ] Disable continue button until checkbox is checked
  - [ ] Handle navigation to next screen after acceptance
- [ ] Update AuthViewModel
  - [ ] Integrate with OnboardingService
  - [ ] Add logic to check if disclaimer needs to be shown
- [ ] Test Functionality
  - [ ] Verify disclaimer is shown to new users
  - [ ] Verify checkbox must be checked to proceed
  - [ ] Verify acceptance is recorded in Firestore
  - [ ] Test UI rendering on different device sizes

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:**
  - Test OnboardingService methods for tracking and updating disclaimer acceptance
  - Test AuthViewModel integration with OnboardingService
  - Verify DisclaimerVersion model behaves as expected

- **Integration Tests:**
  - Test Firestore integration for recording acceptance
  - Verify navigation flow works correctly

- **Manual Verification:**
  - Verify disclaimer text is displayed properly and scrollable
  - Check that the continue button is disabled until checkbox is checked
  - Test UI rendering on different device sizes (especially text readability)
  - Verify back button works correctly
  - Test the complete flow from login to main app after accepting disclaimer 