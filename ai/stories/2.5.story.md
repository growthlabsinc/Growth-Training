# Story 2.5: Onboarding Flow Orchestration

**Status:** Review

## Goal & Context

**User Story:** As a new User, I want a smooth onboarding sequence that guides me through account creation, disclaimers, and policy acceptance before landing on the main app dashboard.

**Context:** This story builds upon the previous onboarding stories (2.1â€“2.4), which implemented individual screens for account creation, medical disclaimer, and privacy/terms acceptance. Now, we need to orchestrate these screens into a seamless, logical onboarding flow that tracks user progress, handles drop-offs, and ensures users complete all required steps before accessing the main app. This is essential for both compliance and user experience.

## Detailed Requirements

- Orchestrate the sequence of onboarding screens:
  1. Welcome/Intro (Optional, can be part of Login/Create)
  2. Account Creation / Login
  3. Medical Disclaimer & Safety Info
  4. Privacy Policy & Terms of Use
  5. (Optional: Brief app tutorial or initial profile setup questions)
  6. Main App Dashboard
- Ensure that if a user drops off during onboarding, they can resume from where they left off (or the beginning of the consent steps) upon next app open.
- Once onboarding is complete, users should go directly to the main app on subsequent launches.

## Acceptance Criteria (ACs)

- AC1: Onboarding flow proceeds in the correct, defined order.
- AC2: User state (completed steps) is correctly tracked.
- AC3: Users who have completed onboarding are taken directly to the main app.
- AC4: The flow feels logical and not overly burdensome to the user.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**
  - Files to Create:
    - `Growth/Features/Onboarding/Views/OnboardingFlowCoordinator.swift` (or similar): Handles navigation and state for onboarding sequence.
    - (Optional) `Growth/Features/Onboarding/Views/WelcomeView.swift` and/or `ProfileSetupView.swift` if not already present.
  - Files to Modify:
    - `Growth/Features/Onboarding/ViewModels/OnboardingViewModel.swift`: Add state machine logic for onboarding steps.
    - `Growth/Features/Onboarding/Services/OnboardingService.swift`: Ensure onboarding state is persisted and restored.
    - `Growth/Features/Authentication/ViewModels/AuthViewModel.swift`: Ensure integration with onboarding flow.
    - App entry point (e.g., `App.swift` or `RootView.swift`): Route user to onboarding or main app as appropriate.

- **Key Technologies:**
  - SwiftUI navigation (NavigationStack, programmatic navigation)
  - Combine for state management
  - Firebase Firestore for persisting onboarding/completion state
  - Local storage (UserDefaults or similar) for caching progress

- **UI/UX Notes:**
  - Follow the [Style Guide](docs/style-guide.md) for all colors, typography, spacing, and component usage.
  - Reference the [UI/UX Spec](docs/ui-ux-spec.md) for onboarding flow, navigation, and user journey.
  - Use the [Figma Design](https://www.figma.com/design/7KW2CPstr0dgseeVWptqyi/UX-Pilot--AI-UI-Generator---AI-Wireframe-Generator--Community-?node-id=1-446&t=oueCP1XvFsZgvW1q-1) for layout, transitions, and visual details.
  - The onboarding flow should feel calm, professional, and supportive, with clear progress indication (e.g., progress bar or step indicator).
  - All screens should be accessible, support Dynamic Type, and be visually consistent.
  - If a Welcome/Intro or Profile Setup screen is included, ensure it is concise and optional.

- **Data Structures:**
  - Extend user model/profile to track onboarding completion and which steps are done.
  - Use enums or similar for onboarding step state machine.

- **Environment Variables:**
  - None specific to this story, but ensure Firebase and local storage are configured.

- **Coding Standards Notes:**
  - Follow standards in `docs/coding-standards.md`.
  - Use dependency injection for services/view models where possible.

## Tasks / Subtasks

- [x] Design onboarding flow state machine (define steps, transitions, and completion logic)
- [x] Implement OnboardingFlowCoordinator (or similar) to manage navigation between onboarding screens
- [x] Update OnboardingViewModel to track and persist onboarding progress
- [x] Integrate onboarding flow with AuthViewModel and app entry point
- [x] Ensure onboarding state is restored on app relaunch (resume where left off)
- [x] Add progress indicator to onboarding screens (per style-guide and Figma)
- [x] Test navigation and state transitions for all onboarding scenarios
- [x] Ensure accessibility and Dynamic Type support on all onboarding screens
- [x] Manual verification of onboarding flow on all supported device sizes

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:**
  - Test onboarding state machine logic and transitions
  - Test persistence and restoration of onboarding progress
- **Integration Tests:**
  - Test full onboarding flow from app launch to main dashboard
  - Test drop-off and resume scenarios
- **Manual/CLI Verification:**
  - Verify onboarding screens appear in correct order
  - Verify user cannot skip required steps
  - Verify completed onboarding routes user to main app on next launch
  - Verify UI/UX matches style-guide, UI/UX spec, and Figma

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Any notes about implementation choices, difficulties, or follow-up needed}
- **Change Log:** {Track changes _within this specific story file_ if iterations occur}
  - Initial Draft 