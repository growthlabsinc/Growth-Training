# Story 20.4: Tour Step 3 - The Unified "Practice" Section

**Status:** Review

## Goal & Context

**User Story:** As a New User on the app tour, I want to understand the "Practice" section, so I know how to start a single, ad-hoc session whenever I want.

**Context:** This story builds upon the app tour framework established in Story 20.1, the dashboard tour step implemented in Story 20.2, and the routines tab tour step implemented in Story 20.3. It implements the third step of the app tour, which introduces new users to the Practice tab in the bottom navigation. This step helps users understand where to find quick, unscheduled practice sessions. The tour continues to use the coach mark/spotlight UI system already implemented, and leverages the manual tab frame calculation approach established in Story 20.3.

## Detailed Requirements

- The tour highlights the "Practice" tab in the bottom navigation bar.
- The popover text should explain: "Want to do a quick, unscheduled session? The 'Practice' tab lets you choose and perform any method you've unlocked."

## Acceptance Criteria (ACs)

- AC1: The tour correctly highlights the "Practice" tab in the bottom navigation.
- AC2: The popover text clearly explains how to start an ad-hoc ("Quick Practice") session.
- AC3: Tapping "Next" proceeds to the next step.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Create: 
    - None (tour steps configuration will be added to existing framework)
  
  - Files to Modify: 
    - `Growth/Features/AppTour/Models/AppTourStep.swift` - Add new tour step to defaultTour configuration
    - `Growth/MainView.swift` - Update setupTabBarFramesForTour to calculate Practice tab frame
    - `GrowthUITests/AppTourUITests.swift` - Add tests for practice tour step

- **Key Technologies:**

  - SwiftUI TabView and custom tab frame calculation
  - AppTourStep configuration model
  - Coach mark UI components already created
  - Manual frame calculation approach from Story 20.3

- **API Interactions / SDK Usage:**

  - No new API interactions required
  - Uses existing AppTourService for state persistence

- **UI/UX Notes:**

  - The tour should highlight the entire Practice tab item in the bottom navigation bar
  - The popover should appear above the tab bar (using `.above` position)
  - Ensure the highlight properly encompasses the icon and "Practice" label
  - The coach mark should dim the rest of the screen while keeping the Practice tab clearly visible
  - Practice tab is at index 2 (third tab) in the tab bar

- **Data Structures:**

  - Add new `AppTourStep` to the `defaultTour` configuration after the routines step:
    ```swift
    AppTourStep(
        id: "practice_tab",
        targetViewId: "practice_tab_item",
        title: "Quick Practice",
        description: "Want to do a quick, unscheduled session? The 'Practice' tab lets you choose and perform any method you've unlocked.",
        highlightPadding: 12,
        position: .above
    )
    ```

- **Environment Variables:**

  - None required for this story

- **Coding Standards Notes:**
  - Follow existing pattern for tour step configuration
  - Maintain consistency with Story 20.3's implementation approach
  - Use the manual tab frame calculation pattern established in Story 20.3
  - Update the previous step (routines) to have `isLastStep: false`

## Tasks / Subtasks

- [x] Update AppTourStep configuration
  - [x] Add new practice tour step after the routines step
  - [x] Update the routines step to have `isLastStep: false`
  - [x] Ensure proper step ordering with practice as step 4 of total steps
- [x] Update tab frame calculation in MainView
  - [x] Add frame calculation for Practice tab (index 2) in setupTabBarFramesForTour
  - [x] Use same calculation approach as Routines tab
  - [x] Update the tour view model with practice tab frame
- [x] Test tour step functionality
  - [x] Verify the Practice tab is properly highlighted
  - [x] Confirm popover appears in correct position above tab bar
  - [x] Test navigation from routines step to practice step
  - [x] Test "Next" button proceeds to next step
- [x] Add UI tests
  - [x] Extend existing tour test to include practice step
  - [x] Verify correct text content in popover
  - [x] Test that this is step 4 in the sequence
  - [x] Test skip functionality still works at this step

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:** 
  - Verify the new tour step is included in the default configuration
  - Test that step IDs remain unique across all tour steps
  - Confirm step count is updated correctly
  
- **UI Tests:** 
  - Extend `testRoutinesTabTourStep()` in `AppTourUITests.swift` to continue to practice step
  - Verify tour progresses from routines step to practice step
  - Test that tapping "Next" moves to the next step
  - Verify step counter shows "Step 4 of X"
  - Verify skip tour functionality remains available
  
- **Manual/CLI Verification:** 
  - Complete onboarding flow and verify tour starts
  - Progress through dashboard and routines steps to reach practice step
  - Verify visual appearance: proper highlighting, popover position, text clarity
  - Test on different iPhone sizes to ensure popover positioning adapts correctly
  - Verify Practice tab (middle tab) is correctly highlighted

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** Claude 3.5 Sonnet (claude-3-5-sonnet-20241022)
- **Completion Notes:** 
  - Successfully implemented the Practice tab tour step as the fourth step in the app tour sequence
  - Added new AppTourStep configuration with appropriate title and description
  - Updated routines step to have `isLastStep: false` and "Next" button
  - Implemented manual frame calculation for Practice tab using same approach as Routines tab
  - Practice tab is at index 2 (third tab) in the tab bar
  - Extended UI tests to verify all four tour steps including the new practice step
  - The implementation follows the existing pattern from Story 20.3
  - All syntax checks pass successfully
- **Change Log:** 
  - Initial Draft - 2025-01-09
  - Implementation Complete - 2025-01-09