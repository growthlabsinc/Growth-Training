# Story 12.1: Develop "Next Session" Suggestion View/Logic

**Status:** Ready

## Goal & Context

**User Story:** As a User, I want to see a clear suggestion for my "Next Session" on the Dashboard or a dedicated view, so I can easily continue my training program.

**Context:** This story builds on the Dashboard view implemented in Epic 11 and integrates with the focus stage tracking (Story 9.4) and readiness status (Story 9.2). The goal is to create a user-friendly way for users to continue their training program by displaying a suggested next session based on their current focus and readiness.

## Detailed Requirements

- Design a UI component or a simple view (potentially integrated into the Dashboard - Epic 11, Story 11.2, or accessible from it) to display the "Next Session" suggestion.
- The suggestion should be based on the user's "current focused stage" (from Epic 9, Story 9.4), their readiness status (Epic 9, Story 9.2), and potentially the last session logged for that method.
- Display the name of the suggested Growth Method and stage.
- Include a direct CTA button like "Start This Session" that navigates to the In-App Timer screen (from Epic 7) pre-configured for the suggested method.
- If no "next session" can be determined (e.g., user needs to select a focus, or has completed all available content), display a relevant message.

## Acceptance Criteria (ACs)

- AC1: A "Next Session" suggestion (method name & stage) is displayed to the user.
- AC2: The suggestion logic correctly uses the user's current focus, readiness, and session history.
- AC3: A "Start This Session" CTA navigates directly to the pre-configured In-App Timer for the suggested method.
- AC4: Appropriate messages are shown if no next session can be determined.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in the codebase and understand the project structure. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Create: 
    - `Growth/Features/Dashboard/ViewModels/NextSessionViewModel.swift` - To handle the next session suggestion logic
    - `Growth/Features/Dashboard/Views/NextSessionView.swift` - To display the next session suggestion UI
  
  - Files to Modify: 
    - `Growth/Features/Dashboard/Views/DashboardView.swift` - To integrate the NextSessionView into the dashboard

- **Key Technologies:**

  - SwiftUI for UI implementation
  - Combine for potential reactive data handling
  - Firebase/Firestore for fetching user data, session history, and method details
  - MVVM pattern for separating business logic from UI

- **API Interactions / SDK Usage:**

  - `FirestoreService` for fetching user's current focus stage, session history, and growth method details
  - `StreakTracker` for potentially integrating with user's activity patterns
  - Integration with `InAppTimerView` from Epic 7 for the "Start This Session" CTA

- **Data Structures:**

  - `GrowthMethod` model (established in previous epics)
  - `User` model with focused stage tracking (from Story 9.4)
  - `SessionLog` model for checking user's history with methods
  - New `NextSessionSuggestion` model to encapsulate the suggestion details

- **Coding Standards Notes:**
  - Follow the established MVVM pattern in the app
  - Ensure proper error handling and loading states
  - Implement accessibility for all UI elements
  - Use SwiftUI's environment objects for dependency injection

## Tasks / Subtasks

- [ ] Create the `NextSessionSuggestion` model
- [ ] Implement `NextSessionViewModel` with logic to determine the next session
  - [ ] Use Firestore to fetch user's current focus stage
  - [ ] Fetch user's readiness status
  - [ ] Check recent session logs
  - [ ] Determine appropriate next session suggestion
  - [ ] Handle edge cases (no focus selected, all content completed)
- [ ] Create `NextSessionView` with UI components
  - [ ] Method name and stage display
  - [ ] Session duration display
  - [ ] "Start This Session" CTA button
  - [ ] Appropriate loading and empty states
- [ ] Integrate `NextSessionView` into the `DashboardView`
- [ ] Implement navigation to Timer view when user taps "Start This Session"
- [ ] Test with different user scenarios (new user, established user, user with all content completed)

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:** 
  - Test the logic in `NextSessionViewModel` for different user scenarios
  - Verify that the correct suggestion is returned based on mock user data
  - Test edge cases (user with no focus, user who completed all content)

- **Manual Verification:** 
  - Verify the UI renders correctly in both light and dark mode
  - Confirm that tapping "Start This Session" navigates to the correctly configured Timer view
  - Test with different user profiles to ensure the suggestion changes appropriately
  - Verify appropriate messages are shown when no next session can be determined

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `Claude 3.7 Sonnet`
- **Completion Notes:** This story implements the next session suggestion feature that helps users easily continue their training program. It leverages existing user data about focused stages and readiness to provide a personalized recommendation. The feature is integrated into the Dashboard to provide a seamless user experience.
- **Change Log:**
  - Initial Draft 