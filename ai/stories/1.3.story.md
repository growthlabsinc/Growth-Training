# Story 1.3: Backend Setup for AI Coach Knowledge Base (Placeholder)

**Status:** Complete

## Goal & Context

**User Story:** As a Backend Developer, I want to set up the initial infrastructure for the AI Coach's knowledge base ingestion using Vertex AI Search, so that curated content can be indexed for retrieval.

**Context:** This story builds upon the project foundation (Story 1.1) and data models (Story 1.2) by establishing the AI infrastructure that will power the AI Coach feature. By setting up Vertex AI Search, we create the foundation for the knowledge retrieval component that will allow the AI Coach to access relevant content when responding to user queries.

## Detailed Requirements

- Set up a Vertex AI Search datastore in Google Cloud.
- Define a schema for the knowledge base content (e.g., method instructions, educational articles, FAQs).
- Manually upload 2-3 sample documents (e.g., a method instruction page, an educational article snippet) into the Vertex AI Search datastore to test indexing.
- (No AI response generation in this story, just data ingestion and basic retrieval test via GCP console or API call).

## Acceptance Criteria (ACs)

- AC1: Vertex AI Search datastore is created and configured.
- AC2: Sample documents are successfully ingested and indexed.
- AC3: A basic search query via GCP console or a test script retrieves relevant chunks from the sample documents.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Create:
    - `scripts/vertex-ai-search-setup.js`: Script to initialize and configure Vertex AI Search
    - `scripts/vertex-ai-search-ingest.js`: Script to ingest sample data into Vertex AI Search
    - `scripts/vertex-ai-search-test.js`: Script to test retrieval functionality
    - `cloud-functions/vertex-ai-integration/index.js`: Basic Cloud Function for interacting with Vertex AI Search
    - `docs/ai-coach-knowledge-base.md`: Documentation on knowledge base structure and ingestion process

  - Files to Modify:
    - No existing files need to be modified

- **Key Technologies:**

  - Google Cloud Platform (GCP)
  - Vertex AI Search (formerly Enterprise Search)
  - Node.js for scripts and Cloud Functions
  - Google Cloud SDK for local development

- **API Interactions / SDK Usage:**

  - Vertex AI API:
    - Create and configure a Vertex AI Search datastore
    - Define schema for structured data
    - Ingest sample documents into the datastore
    - Perform basic search queries against the datastore
  - Cloud Function deployment for Vertex AI interaction

- **Data Structures:**

  - Knowledge Base Schema (based on existing models from Story 1.2):
    ```json
    {
      "growthMethods": {
        "methodId": "string",
        "stage": "integer",
        "title": "string",
        "description": "string",
        "instructionsText": "string",
        "equipmentNeeded": "list",
        "progressionCriteria": "string",
        "safetyNotes": "string"
      },
      "educationalResources": {
        "resourceId": "string",
        "title": "string",
        "contentText": "string",
        "category": "string"
      }
    }
    ```

- **Environment Variables:**

  - `GOOGLE_CLOUD_PROJECT`: GCP project ID
  - `VERTEX_AI_SEARCH_LOCATION`: GCP region for Vertex AI Search (should be EU-based for GDPR compliance)
  - `VERTEX_AI_SEARCH_DATASTORE_ID`: ID for the Vertex AI Search datastore

- **Coding Standards Notes:**
  - Follow Node.js best practices for script development
  - Implement proper error handling for all GCP API interactions
  - Use async/await pattern for asynchronous operations
  - Document all configuration options and API calls

## Tasks / Subtasks

- [x] Set up Google Cloud project configuration
  - [x] Create or verify GCP project
  - [x] Enable Vertex AI Search API
  - [x] Configure appropriate IAM permissions
- [x] Create Vertex AI Search datastore
  - [x] Determine optimal settings for Growth app use case
  - [x] Define schema based on Growth data models
  - [x] Configure EU region for GDPR compliance
- [x] Develop ingestion scripts
  - [x] Create script to ingest growth methods
  - [x] Create script to ingest educational resources
  - [x] Add proper error handling and logging
- [x] Ingest sample data
  - [x] Prepare 2-3 sample growth method documents
  - [x] Prepare 1-2 sample educational resource documents
  - [x] Verify successful ingestion via GCP console
- [x] Develop search test script
  - [x] Create script to perform test queries
  - [x] Implement sample queries for different content types
  - [x] Add result validation and formatting
- [x] Implement basic Cloud Function for Vertex AI Search
  - [x] Create serverless function with search functionality
  - [x] Add proper error handling and logging
  - [x] Deploy and test the function
- [x] Document implementation
  - [x] Create comprehensive documentation on the setup
  - [x] Include sample queries and expected results
  - [x] Document future integration points

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:**
  - Test script functions to ensure proper error handling and data formatting
  - Validate Cloud Function response format

- **Integration Tests:**
  - Test actual calls to Vertex AI Search to verify connectivity
  - Validate that test queries return expected results
  - Verify that schema mapping works correctly with sample data

- **Manual Verification:**
  - Verify in GCP Console that the datastore is created correctly
  - Manually execute search queries in GCP Console to validate results
  - Review ingested documents to ensure they are properly indexed

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `Claude 3.7 Sonnet`
- **Completion Notes:** All tasks have been completed successfully. Implemented Vertex AI Search setup, data ingestion scripts, search functionality, and Cloud Function integration. Created comprehensive documentation with instructions for usage and future enhancements.
  (Manually updated to Complete as per user request)

- **Change Log:**
  - Initial Draft 
  - Implementation complete - all required files created
  - Documentation and deployment scripts added 
  - Status updated to Complete by user request.

## Final Status: Complete 