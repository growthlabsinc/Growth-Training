# Story 2.4: Privacy Policy & Terms of Use Presentation

**Status:** Complete

## Goal & Context

**User Story:** As a new User, I want to be presented with the Privacy Policy and Terms of Use before I can use the app, so that I understand how my data is handled and the terms of service.

**Context:** Following the implementation of medical disclaimers (Story 2.3), we need to complete the onboarding process by presenting the Privacy Policy and Terms of Use to users before they can access the main app. This is a critical legal requirement and ensures users understand their rights and responsibilities when using the app.

## Detailed Requirements

- Create a screen or series of screens to display the Privacy Policy and Terms of Use. (Content to be provided by Legal/Content team).
- Links to view full documents should be available. A summary can be presented.
- User must explicitly accept these to proceed (e.g., checkbox and "Agree & Continue" button).
- This flow must occur after medical disclaimer acceptance, before accessing the main app.
- Record user's acceptance (timestamp, version of policy/terms accepted) in their Firestore user profile.

## Acceptance Criteria (ACs)

- AC1: Privacy Policy and Terms of Use (or summaries with links) are clearly displayed.
- AC2: User cannot proceed to the main app without accepting.
- AC3: Acceptance is recorded in the user's profile in Firestore.
- AC4: UI is clear, readable, and professional.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Create:
    - `Growth/Features/Onboarding/Views/PrivacyPolicyView.swift`: Screen showing privacy policy and terms of use
    - `Growth/Features/Onboarding/Models/PolicyVersion.swift`: Model for tracking policy and terms versions

  - Files to Modify:
    - `Growth/Features/Onboarding/ViewModels/OnboardingViewModel.swift`: Update to include privacy policy state
    - `Growth/Features/Onboarding/Services/OnboardingService.swift`: Extend for handling policy acceptance
    - `Growth/Core/Models/User.swift`: Add fields for storing privacy policy and terms acceptance

- **Key Technologies:**

  - SwiftUI for UI components
  - Firebase Firestore for storing user acceptance data
  - Combine for reactive programming
  - SafariServices for opening web links to full policy/terms documents

- **Firebase Integration:**

  - Add fields to user document in Firestore:
    - `privacyPolicyAccepted`: Boolean
    - `privacyPolicyAcceptedTimestamp`: Timestamp
    - `privacyPolicyVersion`: String
    - `termsAccepted`: Boolean
    - `termsAcceptedTimestamp`: Timestamp
    - `termsVersion`: String

- **UI/UX Notes:**

  - The privacy policy screen should include:
    - Clear title indicating this is the Privacy Policy and Terms of Use
    - Tab view or segmented control to switch between Privacy Policy and Terms of Use
    - Scrollable text area containing the summary text for each document
    - Links to view the full documents in Safari or an in-app browser
    - Checkbox for user acknowledgment with clear label
    - Primary button to proceed (disabled until checkbox is checked)
    - Back button to return to disclaimer screen
  - Text should be well-formatted, with headings and paragraphs for readability
  - Consider using a card-based layout to visually separate different sections
  - Ensure text is readable on all device sizes (test on smallest supported iPhone)
  - UI should follow the style guide with appropriate typography, colors, and spacing
  - Consider adding a progress indicator to show where the user is in the onboarding flow

- **Navigation Flow:**
  - This screen should appear after the medical disclaimer screen
  - Upon acceptance, proceed to the main app or any other remaining onboarding screens

- **Policy/Terms Content:**
  For development purposes, use this placeholder content:

  **Privacy Policy Summary:**
  ```
  PRIVACY POLICY SUMMARY

  Last Updated: [Current Date]

  The Growth app respects your privacy and is committed to protecting your personal data. This summary provides key points from our full Privacy Policy.

  1. DATA WE COLLECT

  We collect:
  - Account information (email, authentication data)
  - Usage data (sessions, methods used, progress)
  - Device information (model, operating system)
  - Optional health-related information you choose to provide

  2. HOW WE USE YOUR DATA

  We use your data to:
  - Provide and improve the Growth app services
  - Personalize your experience
  - Communicate with you about the service
  - Develop new features based on aggregated patterns

  3. DATA STORAGE & SECURITY

  - We employ industry-standard security measures
  - Data is stored using Firebase services
  - Personal information is encrypted in transit and at rest
  - We retain your data only as long as necessary

  4. YOUR RIGHTS

  You have the right to:
  - Access your personal data
  - Request corrections to inaccurate data
  - Request deletion of your data
  - Opt out of certain data collection

  5. ANALYTICS & THIRD PARTIES

  - We use analytics to improve the app
  - Limited data may be shared with service providers
  - We do not sell your personal information

  For complete details, please read our full Privacy Policy.
  ```

  **Terms of Use Summary:**
  ```
  TERMS OF USE SUMMARY

  Last Updated: [Current Date]

  Welcome to Growth. By using our app, you agree to these Terms of Use.

  1. ACCEPTANCE OF TERMS

  By creating an account or using Growth, you agree to be bound by these Terms and our Privacy Policy.

  2. ACCOUNT RESPONSIBILITIES

  You are responsible for:
  - Maintaining the confidentiality of your account
  - All activities that occur under your account
  - Providing accurate information

  3. PERMITTED USE

  You may use Growth for personal, non-commercial purposes only. You agree not to:
  - Use the app for illegal purposes
  - Attempt to gain unauthorized access
  - Copy or modify the app or its content
  - Share your account with others

  4. HEALTH DISCLAIMER

  Growth is not a medical app. It provides educational information only. See our Medical Disclaimer for complete information.

  5. INTELLECTUAL PROPERTY

  All content, features, and functionality of Growth are owned by us and protected by copyright and other intellectual property laws.

  6. TERMINATION

  We reserve the right to terminate or suspend your account for violations of these Terms.

  7. LIMITATION OF LIABILITY

  We are not liable for any damages resulting from your use of the app.

  For complete details, please read our full Terms of Use.
  ```

- **Error Handling:**
  - If Firestore update fails, retry the operation and provide feedback to the user
  - Cache acceptance locally until confirmation of successful Firestore update
  - Handle errors when opening external links

## Tasks / Subtasks

- [ ] Update User model
  - [ ] Add fields for tracking privacy policy and terms acceptance
- [ ] Update PolicyVersion model
  - [ ] Define properties for version, content, and required fields for both privacy policy and terms
- [ ] Extend OnboardingService
  - [ ] Add methods to record privacy policy and terms acceptance in Firestore
  - [ ] Implement caching for acceptance data
- [ ] Update OnboardingViewModel
  - [ ] Add state tracking for privacy policy and terms acceptance
  - [ ] Implement flow control logic
- [ ] Build PrivacyPolicyView
  - [ ] Create UI with tab view or segmented control for switching between policy and terms
  - [ ] Implement scrollable text areas with formatted content
  - [ ] Add external links to full documents
  - [ ] Implement checkbox for user acknowledgment 
  - [ ] Add "Agree & Continue" button with proper disable/enable logic
  - [ ] Handle navigation to next screen after acceptance
- [ ] Test Functionality
  - [ ] Verify policy and terms are displayed properly
  - [ ] Verify checkbox must be checked to proceed
  - [ ] Verify acceptance is recorded in Firestore
  - [ ] Test external links functionality
  - [ ] Test UI rendering on different device sizes

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:**
  - Test OnboardingService methods for recording privacy policy and terms acceptance
  - Test PolicyVersion model behaves as expected
  - Test OnboardingViewModel state management for policy/terms flow

- **Integration Tests:**
  - Test Firestore integration for recording acceptance of both policy and terms
  - Verify navigation flow works correctly between disclaimer and privacy policy screens

- **Manual Verification:**
  - Verify policy and terms text are displayed properly and scrollable
  - Check that links to full documents work correctly
  - Verify the continue button is disabled until checkbox is checked
  - Test UI rendering on different device sizes (especially text readability)
  - Verify back button works correctly
  - Test the complete flow from login through disclaimer and policy screens to main app 