# Story 8.4: Optional Mood Check-Ins (Before/After Session)

**Status:** Ready

## Goal & Context

**User Story:** As a User, I want the option to quickly log my mood before and/or after a session, so I (and potentially the AI coach in the future) can see correlations with my training.

**Context:** The Growth app already allows users to log their practice sessions via the timer or manual entry. This story enhances the session logging functionality by adding optional mood check-ins before and after sessions, giving users the ability to track their emotional state changes and potentially correlate practice with mood improvements over time.

## Detailed Requirements

- When starting a session via the timer, or when manually logging a session, provide an *optional* prompt for a "Pre-Session Mood Check-in".
- After completing a timed session or when saving a manual log, provide an *optional* prompt for a "Post-Session Mood Check-in".
- Mood input should be simple (e.g., 3-5 emoticons/options: Very Good, Good, Neutral, Bad, Very Bad).
- Store selected mood(s) as part of the `sessionLogs` entry in Firestore.
- Users should be able to easily skip this step.

## Acceptance Criteria (ACs)

- AC1: Optional mood check-in prompts are presented at appropriate times (before/after session).
- AC2: User can select a mood from a simple set of options or skip the step.
- AC3: Selected mood data is saved with the session log in Firestore if provided.
- AC4: The process is quick and unobtrusive.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards and understand the project structure.

- **Relevant Files/Components to Modify:**
  - `Growth/Core/Models/SessionLog.swift` - Already contains the `Mood` enum with mood options
  - `Growth/Features/SessionLogging/Views/LogSessionView.swift` - Already contains mood picker UI components
  - `Growth/Features/SessionLogging/ViewModels/LogSessionViewModel.swift` - Update to handle mood data
  - `Growth/Features/Timer/ViewModels/TimerViewModel.swift` - Add pre/post session mood capture
  - `Growth/Features/Timer/Views/TimerView.swift` - Add mood check-in UI before/after timer session
  - `Growth/Core/Services/FirestoreService.swift` - Ensure mood data is properly stored

- **Key Technologies:**
  - SwiftUI for mood selection interface
  - Firestore for storing mood data with session logs
  - Combine for reactive data flow

- **API Interactions / SDK Usage:**
  - Use `FirestoreService.logSession()` to save session data including moods
  - Mood data structure already exists in the `SessionLog` model

- **UI/UX Notes:**
  - Use emoji-based mood input for intuitive selection (`Mood.emoji` property)
  - Ensure mood selection is clearly optional (provide skip button)
  - Use consistent UI between timer and manual logging flows
  - Keep the UI simple and non-disruptive to the practice experience

- **Data Structures:**
  - The `SessionLog` model already has `moodBefore` and `moodAfter` properties
  - The `Mood` enum already has cases for the required mood options
  - No new data structures needed, just UI implementation

- **Coding Standards Notes:**
  - Follow existing SwiftUI patterns in the app
  - Keep the mood selection UI consistent between different entry points
  - Use clear, descriptive variable names
  - Ensure proper error handling and loading states

## Tasks / Subtasks

- [ ] Review existing `LogSessionView` implementation to understand how mood check-ins are currently handled
  - [ ] Note any UI patterns to maintain consistency
  - [ ] Identify if any modifications needed to the current mood picker UI

- [ ] Update Timer flow to incorporate mood check-ins
  - [ ] Add pre-session mood check-in when starting a timer session
  - [ ] Add post-session mood check-in when completing a timer session
  - [ ] Ensure mood data from timer sessions is passed to the session log

- [ ] Enhance manual session logging to prioritize mood check-ins
  - [ ] Make mood section more prominently featured in the UI
  - [ ] Add visual explanation of the purpose of mood tracking

- [ ] Update SessionLog-related services
  - [ ] Ensure mood data is properly stored in Firestore
  - [ ] Verify mood data is properly retrieved from Firestore

- [ ] Add UI for displaying mood changes in session details
  - [ ] Show before/after mood in session detail view
  - [ ] Consider adding a visual representation of mood change (e.g., arrow)

- [ ] Add analytics tracking for mood features
  - [ ] Track usage of mood tracking feature
  - [ ] Track mood distribution across sessions

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:**
  - Test handling of mood data in the SessionLog model
  - Verify proper saving and loading of mood data from Firestore
  - Test mood selection validation logic

- **Integration Tests:**
  - Test complete flow of timer session with mood check-ins
  - Test manual logging flow with mood check-ins
  - Verify mood data persistence across app restarts

- **Manual Verification:**
  - Verify mood selection UI is intuitive and easy to use
  - Test that skipping mood input works as expected
  - Verify that mood data appears correctly in session history and details
  - Check that mood tracking doesn't disrupt the main user flows (timer, session logging)
  - Test across different devices to ensure responsive UI 