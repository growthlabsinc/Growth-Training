# Story 16.2: Implement Day-Specific Timer Interfaces & Routine Details

**Status:** Review

## Goal & Context

**User Story:** As a User, I want the timer interface to be specific to my routine's scheduled day and method, and easily access details about my weekly routine schedule.

**Context:** This story builds upon the multi-method guided practice flow (Story 16.1) by implementing day-specific timer configurations and enhancing the routine details view with interactive day cards. The app already has DaySchedule and Routine models, as well as basic routine views, but needs enhanced visualization and day-specific timer configurations to provide a more tailored experience for each training day.

## Detailed Requirements

- **Day-Specific Timers:** The timer interface within the Unified Practice screen (from previous UI/UX plan, now evolved for routines) must load configurations based on the specific method scheduled for that routine day (intensity, duration, specific Angion Method).
- **Routine Day Cards & Details (Routines Tab):**
  - Implement "Day cards" in the "Current Routine" weekly overview, showing practice type (Heavy, Moderate, Light, Rest), method count badges, and visual intensity indicators (color-coded).
  - Allow users to tap on a day card to see collapsible day details with all scheduled methods and their parameters.

## Acceptance Criteria (ACs)

- AC1: The timer interface is configured dynamically based on the selected routine day and method.
- AC2: The "Current Routine" view in the Routines tab displays day cards with practice type, method count, and intensity indicators.
- AC3: Users can expand day cards to see detailed method breakdowns for each day of their routine.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards and understand the project structure. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Create: 
    - `Growth/Features/Routines/Views/Components/DayCardView.swift`
    - `Growth/Features/Routines/Views/Components/IntensityIndicator.swift`
    - `Growth/Features/Routines/Views/Components/MethodSummaryRow.swift`
  - Files to Modify: 
    - `Growth/Features/Routines/Views/CurrentRoutineView.swift`
    - `Growth/Features/Routines/Views/DailyRoutineView.swift`
    - `Growth/Features/Timer/ViewModels/TimerViewModel.swift`
    - `Growth/Features/Timer/Services/TimerService.swift`

- **Key Technologies:**

  - SwiftUI for UI components with expandable cards
  - Combine for reactive state management
  - @State and @Binding for card expansion state
  - GeometryReader for dynamic layouts

- **API Interactions / SDK Usage:**

  - GrowthMethodService for fetching method details
  - Existing TimerConfiguration model from GrowthMethod
  - FirestoreService for routine data if needed

- **UI/UX Notes:** 

  - Day cards should use color coding:
    - Heavy days: Color("GrowthGreen") 
    - Moderate days: Color("BrightTeal")
    - Light days: Color("MintGreen")
    - Rest days: Color("PaleGreen")
  - Method count badges should be prominent
  - Smooth animations for card expansion
  - Follow established card design patterns from CardView component

- **Data Structures:**

  - Use existing DaySchedule model with properties:
    - dayNumber, dayName, description
    - methodIds array for practice days
    - isRestDay boolean flag
  - Use existing Routine model with schedule array
  - Leverage GrowthMethod.timerConfig for timer settings

- **Environment Variables:**

  - None specific to this story

- **Coding Standards Notes:**
  - Use AppTheme.Typography for consistent text styling
  - Implement proper accessibility labels for cards
  - Ensure smooth animations with .spring() modifier
  - Follow existing card component patterns

## Tasks / Subtasks

- [x] Create DayCardView component
  - [x] Design card layout with day info and visual indicators
  - [x] Add method count badge
  - [x] Implement color coding based on day type
  - [x] Add tap gesture for expansion
- [x] Create IntensityIndicator component
  - [x] Visual representation of practice intensity
  - [x] Color-coded based on day type
  - [x] Animated transitions
- [x] Create MethodSummaryRow component
  - [x] Compact method display for expanded cards
  - [x] Show method name and duration
  - [x] Visual hierarchy for multiple methods
- [x] Update CurrentRoutineView
  - [x] Replace existing layout with day cards
  - [x] Implement expansion/collapse logic
  - [ ] Add week navigation if needed
- [x] Enhance timer configuration loading
  - [x] Extract timer config from selected method
  - [x] Apply day-specific settings to timer
  - [x] Ensure proper countdown/interval setup
- [x] Update DailyRoutineView
  - [x] Pass timer configuration to TimerView
  - [x] Show day-specific information in header
- [x] Add animations and transitions
  - [x] Smooth card expansion animations
  - [x] Haptic feedback for interactions
  - [x] Loading states for method details

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach.

- **Unit Tests:** 
  - Test day type determination logic (Heavy/Moderate/Light/Rest)
  - Verify timer configuration extraction from methods
  - Test card expansion state management
- **Integration Tests:** 
  - Test navigation from day card to daily routine view
  - Verify timer loads with correct configuration
  - Test week navigation if implemented
- **Manual/CLI Verification:** 
  - Create test routine with varied day types
  - Verify color coding matches specifications
  - Test card expansion/collapse animations
  - Confirm timer configurations apply correctly

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** Claude Opus 4 (claude-opus-4-20250514)
- **Completion Notes:** 
  - Successfully implemented interactive day cards with expandable method details
  - Created three different intensity indicator designs (bar, circular, and dot styles)
  - Enhanced CurrentRoutineView with new day cards replacing the simple list view
  - Updated DailyRoutineView with gradient hero section showing practice type
  - Timer configuration already properly loads from GrowthMethod.timerConfig
  - Added color coding based on practice intensity (Heavy/Moderate/Light/Rest)
  - Implemented smooth animations and haptic feedback throughout
  - Week navigation was marked as optional and not implemented in this iteration
- **Change Log:** 
  - Initial Draft - Created story based on Epic 16 requirements
  - Implementation completed - All required ACs met with enhanced visual design