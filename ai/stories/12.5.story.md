# Story 12.5: Activate "Start In-App Timer" Button and Finalize Timer View

**Status:** Draft

## Goal & Context

**User Story:** As a User, I want the "Start In-App Timer" button on all Method Detail pages and from the "Next Session Detail" view to be fully functional, launching the correctly configured In-App Timer view.

**Context:** The Timer module (Epic 7) is already implemented but the entry points from Growth Method detail screens and the new Next Session flow (Stories 12.1 & 12.2) still use placeholder actions. This story connects those entry points, ensures the Timer receives the selected `methodId` and timing metadata, and verifies the full end-to-end flow: Method Detail → Timer → Session Log, and Dashboard → Next Session Suggestion → Next Session Detail → Timer → Session Log.

## Detailed Requirements

Copying from `docs/epic12.md` Story 12.5:

- Ensure the "Start In-App Timer" CTA on the Method Detail screen correctly navigates to the In-App Timer screen.
- Ensure the "Begin Session" CTA on the "Next Session Detail" view correctly navigates to the In-App Timer screen.
- Pass the selected `methodId` and its timer configurations (recommended duration, countdown settings, intervals) to the Timer screen from both entry points.
- Verify the Timer screen:
  - Loads method-specific configurations.
  - Functions as a stopwatch or countdown.
  - Handles intervals and alerts (breaks, overexertion).
  - Connects to the post-timer logging flow (pre-filled Log Session View).
- Conduct thorough testing of the end-to-end flows:
  1. Method Detail → Timer → Log Session.
  2. Dashboard → Next Session Suggestion → Next Session Detail → Timer → Log Session.

## Acceptance Criteria (ACs)

- AC1: Tapping "Start In-App Timer" on any Method Detail page launches the In-App Timer view.
- AC2: Tapping "Begin Session" on the "Next Session Detail" view launches the In-App Timer view.
- AC3: The In-App Timer is correctly pre-configured with the specific method's duration, countdown/stopwatch mode, and interval settings from both entry points.
- AC4: All functionalities of the In-App Timer view (start, pause, resume, reset, alerts) work as designed in Epic 7.
- AC5: The post-timer flow to log the session with pre-filled data is functional.

## Technical Implementation Context

**Guidance:** Developer must follow project standards in `docs/coding-standards.md` and structure described in `docs/project-structure.md`.

- **Relevant Files:**
  - Modify:
    - `Growth/Features/GrowthMethods/Views/GrowthMethodDetailView.swift`
    - `Growth/Features/NextSession/Views/NextSessionDetailView.swift` (path may vary)
    - `Growth/Features/Timer/Views/TimerView.swift` & `TimerViewModel.swift` (ensure config injection)
    - `Growth/Features/Timer/Models/TimerState.swift` (if additional fields needed)
  - Create (if missing):
    - Navigation helper / router extension to push TimerView with parameters.

- **Key Technologies:** SwiftUI, MVVM, Combine, Firestore (to load method config), local notification scheduling for interval alerts.

- **API Interactions / SDK Usage:**
  - Use `FirestoreService.getGrowthMethod(methodId:)` to fetch timer configuration.
  - Timer alerts use `UserNotifications` via existing `NotificationsManager`.

- **UI/UX Notes:**
  - Timer must display method title and remaining time.
  - Ensure light & dark mode support.

- **Data Structures:**
  - `GrowthMethod` model already contains `estimatedDurationMinutes`, `intervals`, etc.
  - Pass a lightweight `TimerConfig` struct to `TimerViewModel` (if not already present).

- **Environment Variables:** None new.

## Tasks / Subtasks

- [ ] Review current navigation flow from `GrowthMethodDetailView` and wire the "Start In-App Timer" button to push `TimerView`.
- [ ] Create/verify a `TimerConfig` initializer that accepts a `GrowthMethod`.
- [ ] Inject `TimerConfig` (or `methodId`) into `TimerViewModel` via the navigation.
- [ ] Load method-specific timer settings in `TimerViewModel.onAppear`.
- [ ] Repeat wiring for `NextSessionDetailView` "Begin Session" CTA.
- [ ] Ensure `TimerView` exposes a completion handler to present `LogSessionView` with pre-filled data.
- [ ] QA Flow 1: Method Detail → Timer → Log Session (verify data passed & saved).
- [ ] QA Flow 2: Dashboard → Next Session Suggestion → Next Session Detail → Timer → Log Session.
- [ ] Update unit/UI tests if they exist for navigation.

## Testing Requirements

- **Manual End-to-End:** Execute both flows on iPhone & iPad simulators in light & dark mode.
- **Unit Tests:** TimerViewModel should correctly apply configurations for a mock `GrowthMethod`.
- **UI Tests (optional):** XCUITest to tap Start Timer and confirm TimerView appears with expected label.

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:**
- **Change Log:**
  - Initial Draft 