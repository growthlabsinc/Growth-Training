# Story 6.5: AI Knowledge Base Content - Initial Curation & Ingestion

**Status:** In Progress

## Goal & Context

**User Story:** As a PM/Content Team, I want the initial set of curated content (Growth Method instructions, educational articles already in Firestore) to be prepared and ingested into the Vertex AI Search datastore, so the AI Coach has foundational knowledge.

**Context:**
This story is the fifth step in Epic 6, focused on building the knowledge base for the AI Growth Coach feature. It builds upon the prior stories (6.1-6.4) by providing the AI with actual content to reference when answering user queries. The knowledge base will initially contain existing Growth Method instructions (from Epic 3) and Educational Resource content (from Epic 5), allowing the AI to provide helpful, accurate responses about topics already in the app.

## Detailed Requirements

- Identify all existing Growth Method instructional content (from Epic 3) and Educational Resource content (from Epic 5) that will form the initial knowledge base.
- Format this content as needed for ingestion into Vertex AI Search (e.g., plain text, structured JSON/CSV if applicable).
- Create a document `docs/ai-coach-knowledge-base-sources.md` listing all documents/sources approved for AI training.
- Write and test scripts to extract content from Firestore and prepare it for Vertex AI Search ingestion.
- Upload this curated content set into the designated Vertex AI Search datastore.
- Verify content is indexed and searchable via Vertex AI console.
- Document the data schema, source extraction process, and ingestion method for future content updates.

## Acceptance Criteria (ACs)

- AC1: Instructional content from at least 5-7 Growth Methods is ingested into Vertex AI Search.
- AC2: Content from at least 3-5 Educational Resources is ingested into Vertex AI Search.
- AC3: `docs/ai-coach-knowledge-base-sources.md` is created and lists the ingested content.
- AC4: Ingested content can be successfully retrieved via test queries in the Vertex AI console.
- AC5: Data extraction and ingestion scripts are documented and stored in the repository.
- AC6: Knowledge base schema and structure aligns with `docs/ai-coach-knowledge-base.md` specifications.

## Technical Implementation Context

**Guidance:**
Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/templates/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**
  - Files to Create:
    - `scripts/vertex-ai-search-setup.js` (or similar naming) - Set up Vertex AI Search datastore
    - `scripts/vertex-ai-search-ingest.js` (or similar naming) - Extract and ingest data
    - `scripts/vertex-ai-search-test.js` (or similar naming) - Test search functionality
    - `docs/ai-coach-knowledge-base-sources.md` - Catalog of ingested content
  - Files to Modify/Reference:
    - `docs/ai-coach-knowledge-base.md` - For schema reference
    - Existing Firestore models: `Growth/Core/Models/GrowthMethod.swift` and `Growth/Core/Models/EducationalResource.swift`

- **Key Technologies:**
  - Google Cloud's Vertex AI Search (formerly Enterprise Search)
  - Firestore (data source)
  - Node.js (recommended for scripts)
  - Google Cloud Storage (may be used for intermediate file storage)

- **Implementation Notes:**
  - **Data Structure:** Follow the schema in `docs/ai-coach-knowledge-base.md` for both Growth Methods and Educational Resources.
  - **Extraction Process:**
    - Read from Firestore using authenticated admin credentials (not client SDK).
    - Ensure all rich content is properly converted (e.g., markdown to text if needed).
    - Maintain metadata associations (e.g., categories, stages, etc.).
  - **Ingestion Process:**
    - Set up Vertex AI Search datastore with appropriate configuration (see doc for details).
    - Choose appropriate ingestion method (direct API, JSONL files via GCS, etc.).
    - Use incremental reconciliation mode for the initial load.
  - **Testing:**
    - Verify search works with various query types (e.g., method names, topics, stages).
    - Test result relevance and content accuracy.

- **API Usage:**
  - Document all Google Cloud API calls in scripts with comments.
  - Use environment variables for project IDs, locations, and other configuration parameters.
  - Ensure all API credentials are properly managed (not hardcoded).

- **Documentation Requirements:**
  - Document each script's purpose, inputs, outputs, and usage.
  - Record the JSON schema used for data ingestion.
  - Create the content source listing document with metadata (titles, types, IDs).

## Tasks / Subtasks

- [ ] Review existing content in Firestore databases for Growth Methods and Educational Resources.
- [ ] Design extraction strategy and JSON schema for Vertex AI Search.
- [ ] Create `scripts/vertex-ai-search-setup.js` to set up the Vertex AI Search datastore.
  - [ ] Configure datastore with appropriate parameters (location, vertical, content config).
  - [ ] Set up schema definitions if needed.
- [ ] Create `scripts/vertex-ai-search-ingest.js` to extract and ingest data.
  - [ ] Connect to Firestore and extract Growth Method data.
  - [ ] Connect to Firestore and extract Educational Resource data.
  - [ ] Transform data to required format for Vertex AI Search.
  - [ ] Upload data to Vertex AI Search datastore.
- [ ] Create `scripts/vertex-ai-search-test.js` to test search functionality.
  - [ ] Implement sample queries that should return various content types.
  - [ ] Validate search results contain expected content.
- [ ] Create `docs/ai-coach-knowledge-base-sources.md` listing all ingested content.
  - [ ] Document each Growth Method with name, ID, and metadata.
  - [ ] Document each Educational Resource with title, category, and ID.
- [ ] Test the knowledge base via the Vertex AI console.
  - [ ] Verify different query types return relevant results.
  - [ ] Ensure content is accurately represented in search results.
- [ ] Document the entire process in README files and code comments.

## Testing Requirements

**Guidance:**
Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Functional Testing:**
  - Test that scripts successfully connect to Firestore and extract the required data.
  - Test that data transformation logic correctly formats the data for Vertex AI Search.
  - Test that the Vertex AI Search datastore is properly configured and accessible.
  - Test that ingestion process successfully uploads all content items.
  - Test that search functionality returns relevant results for various query types.

- **Content Testing:**
  - Verify that Growth Method content is accurately represented in search results.
  - Verify that Educational Resource content is accurately represented in search results.
  - Verify that metadata (e.g., categories, stages) is preserved and searchable.

- **Documentation Testing:**
  - Verify that `docs/ai-coach-knowledge-base-sources.md` accurately lists all ingested content.
  - Verify that script documentation provides clear instructions for future use.

- **Manual/Exploratory Testing:**
  - Use the Vertex AI console to perform sample searches.
  - Verify that search results contain the expected content.
  - Try various query types to ensure comprehensive coverage.

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Any notes about implementation choices, difficulties, or follow-up needed}
- **Change Log:**
  - Initial Draft 