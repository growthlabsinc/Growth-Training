# Story 5.2: Article View Screen

**Status:** Complete

## Goal & Context

**User Story:** As a User, I want to read the full content of a selected educational article, including text and any embedded visuals, so I can gain knowledge on the topic.

**Context:** This story follows Story 5.1 (Educational Resources Listing Screen), which provides navigation to this Article View. It focuses on displaying the detailed content of a single educational resource fetched from Firestore.

## Detailed Requirements

- Design and implement an "Article View" screen.
- Screen should receive a `resourceId` (passed from Story 5.1) and fetch the full article content from the `educationalResources` collection in Firestore.
- Display:
    - Article Title.
    - Full article `contentText` (fetched from `educationalResources` collection).
    - `visualPlaceholderUrl` as an image if present, otherwise a generic placeholder.
- Ensure content is scrollable and formatted for optimal readability (font sizes, line spacing as per `docs/style-guide.md`).
- Clear navigation back to the Educational Resources listing screen (Story 5.1).

## Acceptance Criteria (ACs)

- AC1: Article View screen correctly displays the full title and `contentText` for a selected article, fetched by `resourceId`.
- AC2: Text is well-formatted, readable, and supports accessibility (e.g., dynamic type), adhering to `docs/style-guide.md`.
- AC3: If `visualPlaceholderUrl` is valid, an image is displayed; otherwise, a generic placeholder or no image area is shown gracefully.
- AC4: User can easily navigate back to the Educational Resources listing screen.
- AC5: Loading and error states (e.g., for Firestore fetch, invalid `resourceId`) are handled gracefully with user-friendly messages.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/templates/coding-standards.md` and understand the project structure in `docs/templates/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**
  - Files to Create:
    - `Growth/Features/EducationalResources/Views/EducationalResourceDetailView.swift`
    - `Growth/Features/EducationalResources/ViewModels/EducationalResourceDetailViewModel.swift`
  - Files to Modify:
    - `Growth/Features/EducationalResources/Views/EducationalResourcesListView.swift` (or equivalent) to implement navigation to `EducationalResourceDetailView`, passing the `resourceId`.

- **Key Technologies:**
  - SwiftUI for UI implementation.
  - Combine or async/await for data fetching and state management in the ViewModel.
  - Firebase Firestore for data persistence.

- **API Interactions / SDK Usage:**
  - Firebase Firestore SDK:
    - Fetch a single document from the `educationalResources` collection using the provided `resourceId`.
    - Refer to `docs/data-models.md` for the `EducationalResource` model structure.

- **UI/UX Notes:**
  - The screen should have a navigation bar title (e.g., "Article Details" or the article's title).
  - Content should be presented in a clean, scrollable view.
  - Prioritize readability: use appropriate fonts (from `AppTheme.Typography` as defined in `docs/style-guide.md`) and spacing.
  - Visuals (`visualPlaceholderUrl`) should be displayed prominently if available, with fallbacks.
  - Adhere to general UI/UX principles from `docs/ui-ux-spec.md`.

- **Data Structures:**
  - Utilize the `EducationalResource` struct (see `docs/data-models.md`):
    ```swift
    struct EducationalResource: Codable, Identifiable {
        // id should map to resourceId from Firestore document ID
        var id: String? // Optional if not always set directly from documentID in all contexts
        let title: String
        let contentText: String
        let category: ResourceCategory // Ensure this enum is available
        let visualPlaceholderUrl: String?
    }

    // Ensure ResourceCategory enum is defined as per docs/data-models.md
    // enum ResourceCategory: String, Codable, CaseIterable, Hashable { ... }
    ```
  - The ViewModel will likely publish an `EducationalResource?` and loading/error states.

- **Environment Variables:**
  - No new environment variables specific to this story are anticipated.

- **Coding Standards Notes:**
  - Follow general project coding standards outlined in `docs/templates/coding-standards.md`.
  - Implement robust error handling for Firestore fetches (e.g., document not found, network issues).
  - Ensure ViewModel logic is testable.

## Tasks / Subtasks

- [x] Create `EducationalResourceDetailViewModel.swift`.
  - [x] Define properties for the fetched resource, loading state, and error messages.
  - [x] Implement a function to fetch a single `EducationalResource` from Firestore by `resourceId`.
  - [x] Update published properties based on fetch success, failure, or if the document is not found.
- [x] Create `EducationalResourceDetailView.swift`.
  - [x] Accept `resourceId` as an input parameter.
  - [x] Instantiate and use `EducationalResourceDetailViewModel`.
  - [x] Display a loading indicator while data is being fetched.
  - [x] Display an error message if fetching fails or resource not found.
  - [x] If data is successfully fetched, display:
    - Article `title`.
    - `visualPlaceholderUrl` (using `AsyncImage` or similar, with placeholder/error views).
    - `contentText` in a scrollable view, formatted for readability.
    - `category` (optional, if deemed relevant for display on detail view).
  - [x] Implement a back button in the navigation bar or ensure standard navigation behavior allows return.
- [x] Update `EducationalResourcesListView.swift` (from Story 5.1) to navigate to `EducationalResourceDetailView`, passing the selected `resourceId`.
- [x] Ensure UI adheres to `docs/style-guide.md` and `docs/ui-ux-spec.md` for typography, colors, and spacing.
- [x] Add unit tests for `EducationalResourceDetailViewModel` logic (mocking FirestoreService).

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/templates/testing-strategy.md`.

- **Unit Tests:**
  - Test `EducationalResourceDetailViewModel`:
    - Mock `FirestoreService` to simulate successful data fetch for a specific `resourceId`. Verify published resource matches.
    - Simulate Firestore error. Verify error state is published.
    - Simulate `resourceId` not found. Verify appropriate state/message.
- **UI Tests (Manual for MVP):**
  - Navigate from the Educational Resources List (Story 5.1) to the Article View.
  - Verify article title, content, and visual (if available) are displayed correctly.
  - Verify text formatting and scrollability.
  - Verify navigation back to the list screen works.
  - Test with a non-existent `resourceId` to ensure error message is shown.
  - Test loading state display.

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** Claude 3.7 Sonnet
- **Completion Notes:** Successfully implemented the Educational Resource Detail view with proper error handling, loading states, and UI styling according to specifications. Fixed the EnvironmentObject issue in the SwiftUI view, ensuring the AuthViewModel is properly passed through the navigation flow. Added comprehensive unit tests for the ViewModel using mock FirestoreService.
- **Change Log:**
  - Initial implementation of EducationalResourceDetailViewModel (5/20/25)
  - Create EducationalResourceDetailView with proper styling and error handling (5/20/25)
  - Fix EnvironmentObject issue in preview (5/20/25)
  - Remove placeholder view from EducationalResourcesListView (5/20/25)
  - Add unit tests for EducationalResourceDetailViewModel (5/20/25) 