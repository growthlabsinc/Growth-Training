# Story 8.3: Badges Display Screen

**Status:** Ready

## Goal & Context

**User Story:** As a User, I want to view all the badges I've earned and see which ones are still locked, so I can track my achievements.

**Context:** This story builds upon the foundation of Story 8.2, which implemented the logic for defining badges in Firestore and awarding them to users when criteria are met. Now we'll create a dedicated UI screen to display earned and locked badges, providing users with visibility into their achievements and motivation to earn more badges.

## Detailed Requirements

- Create a "My Badges" or "Achievements" screen (e.g., accessible from Profile/Settings or Dashboard).
- Display all defined badges.
- Clearly differentiate between earned badges (e.g., full color icon, achievement date) and locked badges (e.g., grayscale icon, criteria visible).
- Fetch badge definitions from Firestore and user's earned badges from their profile.

## Acceptance Criteria (ACs)

- AC1: User can view a screen listing all available badges.
- AC2: Earned badges are visually distinct from locked badges.
- AC3: Information about how to earn locked badges (criteria) is visible.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards and understand the project structure.

- **Relevant Files/Components to Create:**
  - `Growth/Features/Badges/Views/BadgesView.swift` - Main screen to display all badges
  - `Growth/Features/Badges/Views/BadgeItemView.swift` - Reusable component for individual badge display
  - `Growth/Features/Badges/ViewModels/BadgesViewModel.swift` - ViewModel for badges list
  - `Growth/Features/Badges/Views/BadgeDetailView.swift` - Optional detailed view when tapping on a badge

- **Relevant Files to Modify:**
  - `Growth/Features/Profile/Views/ProfileView.swift` - Add navigation link to Badges view
  - `Growth/Features/Dashboard/Views/DashboardView.swift` - Add badge summary or shortcut to Badges view

- **Key Technologies:**
  - SwiftUI for badge display interface
  - Firestore for badge and user data fetching
  - Combine for reactive data handling
  - Image loading and caching for badge icons

- **API Interactions / SDK Usage:**
  - Firestore to load badge definitions and user's earned badges
  - Use `FirestoreService.getAllBadges()` to fetch badge definitions
  - Use `FirestoreService.getUserBadges(userId:)` to fetch user's earned badges
  - Join these datasets to display both earned and locked badges

- **UI/UX Notes:**
  - Use a grid or list display for badges with clear visual distinction between earned and locked
  - For earned badges: Show full color, completion date, and possibly an indicator for displaying it on user profile
  - For locked badges: Use grayscale or opacity effect, show criteria needed to earn
  - Consider implementing a filter/toggle to show "All", "Earned", or "Locked" badges
  - Consider an animation or highlight for recently earned badges

- **Data Structures:**
  - The existing `Badge` model already has the necessary properties for implementation
  - The `isEarned` computed property can be used to determine badge state
  - Badge criteria are stored in the `criteria` property as [String: Any]

- **Coding Standards Notes:**
  - Ensure proper error handling and loading states
  - Use localized strings for all user-facing text
  - Follow SwiftUI best practices for list/grid displays

## Tasks / Subtasks

- [ ] Create BadgesViewModel
  - [ ] Implement methods to fetch all badges
  - [ ] Add functionality to fetch user's earned badges
  - [ ] Create computed properties for filtering badges (all/earned/locked)
  - [ ] Implement loading and error states

- [ ] Design and build BadgeItemView 
  - [ ] Create visual design for individual badge display
  - [ ] Implement different styles for earned vs. locked badges
  - [ ] Add badge criteria display for locked badges
  - [ ] Handle badge icon loading and placeholder

- [ ] Implement main BadgesView
  - [ ] Create grid or list layout for badges
  - [ ] Add filter/toggle controls for viewing different badge sets
  - [ ] Implement loading and error states
  - [ ] Add pull-to-refresh functionality

- [ ] Create BadgeDetailView (optional)
  - [ ] Show detailed badge information
  - [ ] For earned badges, display date earned and any related statistics
  - [ ] For locked badges, show detailed criteria for earning

- [ ] Add navigation to Badges screen
  - [ ] Add navigation link in ProfileView
  - [ ] Consider adding a badge summary or shortcut on DashboardView

- [ ] Implement any necessary animations
  - [ ] Add subtle animations for transitions between badge states
  - [ ] Consider special highlighting for recently earned badges

- [ ] Add analytics tracking
  - [ ] Track badge view screen visits
  - [ ] Track user interactions with specific badges

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:**
  - Test BadgesViewModel logic for fetching and processing badges
  - Verify correct filtering of earned vs. locked badges
  - Test proper handling of loading and error states

- **Integration Tests:**
  - Verify BadgesView correctly displays badges from Firestore
  - Test navigation flow to and from the Badges screen
  - Verify that earned badges and locked badges display correctly

- **Manual Verification:**
  - Verify badges display correctly with proper styling for earned vs. locked
  - Test UI responsiveness with various badge counts (few badges vs. many badges)
  - Confirm navigation and back navigation work correctly
  - Verify accessibility features (VoiceOver, Dynamic Type support) 