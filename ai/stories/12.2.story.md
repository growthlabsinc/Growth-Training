# Story 12.2: Build Out "Next Session Detail" View

**Status:** Ready

## Goal & Context

**User Story:** As a User, after tapping the "Next Session" suggestion, I want to see a dedicated view with more details about the suggested session, so I can confirm it's what I want to do before starting the timer.

**Context:** This story builds upon Story 12.1, which implemented the "Next Session" suggestion component on the Dashboard. Now we need to create a detailed view that appears after the user taps on the suggestion. The view will provide comprehensive information about the suggested session and offer a CTA to start the timer (leveraging existing timer functionality from Epic 7).

## Detailed Requirements

- Design and implement a new "Next Session Detail" screen. This screen is displayed after the user taps the CTA from Story 12.1.
- This screen should clearly present information about the suggested Growth Method session:
  - Prominent display of the Method Name and Stage.
  - A brief description or key objectives/focus points for this specific session/method.
  - Expected duration (fetched from method configuration).
  - List of required equipment, if any (fetched from method configuration).
  - Option to quickly review the full method instructions (e.g., a button linking to the main Method Detail screen - Epic 3, Story 3.2).
  - A clear "Begin Session" or "Start Timer" CTA that navigates to the In-App Timer screen (from Epic 7), pre-configured for this suggested method.
- UI should be clean, focused, and motivating, adhering to `docs/style-guide.md`.

## Acceptance Criteria (ACs)

- AC1: The "Next Session Detail" view is displayed after tapping the "Next Session" suggestion CTA from the Dashboard.
- AC2: The view accurately displays the method name, stage, description/objectives, duration, and required equipment for the suggested session.
- AC3: A link/button to view full method instructions is present and functional.
- AC4: A "Begin Session" CTA is present and, when tapped, navigates to the In-App Timer, correctly configured for the suggested method.
- AC5: The UI is consistent with the app's style guide.

## Technical Implementation Context

**Guidance:** Use the following details for implementation.

- **Relevant Files:**

  - Files to Create: 
    - `Growth/Features/NextSession/Views/NextSessionDetailView.swift`
    - `Growth/Features/NextSession/ViewModels/NextSessionDetailViewModel.swift`
  - Files to Modify:
    - `Growth/Features/Dashboard/Views/DashboardView.swift` (update navigation)
    - `Growth/Features/Dashboard/Views/NextSessionView.swift` (update navigation)

- **Key Technologies:**

  - SwiftUI for UI components
  - MVVM architecture (with ViewModel)
  - Combine for handling asynchronous events
  - NavigationStack/NavigationLink for navigation

- **API Interactions / SDK Usage:**

  - FirestoreService for fetching GrowthMethod details
  - FirebaseAuth for user authentication

- **UI/UX Notes:**
  - Use the app's existing color scheme and typography
  - Implement a clean, card-based layout similar to GrowthMethodDetailView
  - Use visual hierarchy to emphasize:
    1. Method name and stage
    2. Description and key details
    3. Equipment list
    4. CTA button ("Begin Session")

- **Data Structures:**

  - Leverage existing models:
    - `NextSessionSuggestion` (created in Story 12.1)
    - `GrowthMethod` (for comprehensive method details)
  
- **Navigation Flow:**
  - Dashboard → Next Session suggestion → Next Session Detail → Timer

## Tasks / Subtasks

- [ ] Create NextSessionDetailViewModel
  - [ ] Implement method to fetch complete GrowthMethod details based on the NextSessionSuggestion
  - [ ] Create state variables for loading, error states
  - [ ] Implement timer configuration parameter passing

- [ ] Create NextSessionDetailView
  - [ ] Implement UI layout with all required components
  - [ ] Create navigation link to GrowthMethodDetailView for viewing full instructions
  - [ ] Create navigation link to Timer with proper configuration

- [ ] Update DashboardView Navigation
  - [ ] Modify navigation destination to point to new NextSessionDetailView
  - [ ] Pass NextSessionSuggestion object through navigation

- [ ] Test End-to-End Flow
  - [ ] Test navigation from Dashboard to NextSessionDetailView
  - [ ] Test "View Full Instructions" navigation
  - [ ] Test "Begin Session" navigation to Timer

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:** 
  - Test NextSessionDetailViewModel to ensure it correctly fetches method details
  - Test that error states are handled appropriately

- **Manual Verification:**
  - Visually verify that the UI meets design requirements
  - Test all navigation paths:
    - Dashboard → NextSessionDetailView
    - NextSessionDetailView → GrowthMethodDetailView
    - NextSessionDetailView → Timer
  - Verify that all method details are correctly displayed
  - Verify that the Timer is correctly configured when launched 