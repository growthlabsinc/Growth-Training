# Story 20.5: Tour Step 4 - The Consolidated "Progress" Section

**Status:** Review

## Goal & Context

**User Story:** As a New User on the app tour, I want to know where to find my detailed history and achievements, so I can review my journey over time.

**Context:** This story builds upon the app tour framework established in Story 20.1, the dashboard tour steps from Story 20.2, the routines tab step from Story 20.3, and the practice tab step from Story 20.4. It implements the fifth step of the app tour, which introduces new users to the Progress tab in the bottom navigation. This step helps users understand where to find their detailed session history, statistics, and achievements. The tour continues to use the coach mark/spotlight UI system already implemented, and leverages the manual tab frame calculation approach established in Stories 20.3-20.4.

## Detailed Requirements

- The tour highlights the "Progress" tab in the bottom navigation bar.
- The popover text should explain: "Track your journey in the 'Progress' tab. Here you'll find your detailed session history, stats, and achievements all in one place."

## Acceptance Criteria (ACs)

- AC1: The tour correctly highlights the "Progress" tab in the bottom navigation.
- AC2: The popover text accurately describes the contents of the consolidated Progress section.
- AC3: Tapping "Next" proceeds to the final step.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Create: 
    - None (tour steps configuration will be added to existing framework)
  
  - Files to Modify: 
    - `Growth/Features/AppTour/Models/AppTourStep.swift` - Add new tour step to defaultTour configuration
    - `Growth/MainView.swift` - Update setupTabBarFramesForTour to calculate Progress tab frame
    - `GrowthUITests/AppTourUITests.swift` - Update tests for progress tour step

- **Key Technologies:**

  - SwiftUI TabView and custom tab frame calculation
  - AppTourStep configuration model
  - Coach mark UI components already created
  - Manual frame calculation approach from Stories 20.3-20.4

- **API Interactions / SDK Usage:**

  - No new API interactions required
  - Uses existing AppTourService for state persistence

- **UI/UX Notes:**

  - The tour should highlight the entire Progress tab item in the bottom navigation bar
  - The popover should appear above the tab bar (using `.above` position)
  - Ensure the highlight properly encompasses the icon and "Progress" label
  - The coach mark should dim the rest of the screen while keeping the Progress tab clearly visible
  - Progress tab is at index 3 (fourth tab) in the tab bar: Home(0), Routines(1), Practice(2), Progress(3), Learn(4)

- **Data Structures:**

  - Add new `AppTourStep` to the `defaultTour` configuration after the practice step:
    ```swift
    AppTourStep(
        id: "progress_tab",
        targetViewId: "progress_tab_item",
        title: "Track Your Journey",
        description: "Track your journey in the 'Progress' tab. Here you'll find your detailed session history, stats, and achievements all in one place.",
        highlightPadding: 12,
        position: .above,
        buttonTitle: "Next",
        isLastStep: false
    )
    ```

- **Environment Variables:**

  - None required for this story

- **Coding Standards Notes:**
  - Follow existing pattern for tour step configuration
  - Maintain consistency with Stories 20.3-20.4's implementation approach
  - Use the manual tab frame calculation pattern established previously
  - Update the previous step (practice) to have `isLastStep: false` and `buttonTitle: "Next"`
  - The Progress step should have `buttonTitle: "Next"` since it's not the final step

## Tasks / Subtasks

- [x] Update AppTourStep configuration
  - [x] Add new progress tour step after the practice step
  - [x] Update the practice step to have `isLastStep: false` and `buttonTitle: "Next"`
  - [x] Ensure proper step ordering with progress as step 5 of total steps
- [x] Update tab frame calculation in MainView
  - [x] Add frame calculation for Progress tab (index 3) in setupTabBarFramesForTour
  - [x] Use same calculation approach as previous tabs
  - [x] Update the tour view model with progress tab frame
- [x] Test tour step functionality
  - [x] Verify the Progress tab is properly highlighted
  - [x] Confirm popover appears in correct position above tab bar
  - [x] Test navigation from practice step to progress step
  - [x] Test "Next" button proceeds to next step
- [x] Update UI tests
  - [x] Update step counters from "of 4" to "of 5" (or final count)
  - [x] Extend existing tour test to include progress step
  - [x] Verify correct text content in popover
  - [x] Test that this is step 5 in the sequence
  - [x] Test skip functionality still works at this step

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:** 
  - Verify the new tour step is included in the default configuration
  - Test that step IDs remain unique across all tour steps
  - Confirm step count is updated correctly
  
- **UI Tests:** 
  - Extend `testRoutinesTabTourStep()` in `AppTourUITests.swift` to continue to progress step
  - Verify tour progresses from practice step to progress step
  - Test that tapping "Next" moves to the next step
  - Verify step counter shows "Step 5 of X"
  - Verify skip tour functionality remains available
  
- **Manual/CLI Verification:** 
  - Complete onboarding flow and verify tour starts
  - Progress through all previous steps to reach progress step
  - Verify visual appearance: proper highlighting, popover position, text clarity
  - Test on different iPhone sizes to ensure popover positioning adapts correctly
  - Verify Progress tab (fourth tab) is correctly highlighted

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** Claude 3 Opus (claude-opus-4-20250514)
- **Completion Notes:** 
  - Successfully implemented the Progress tab tour step as the fifth step in the app tour sequence
  - Added new AppTourStep configuration with appropriate title and description
  - Updated practice step to have `isLastStep: false` and "Next" button
  - Implemented manual frame calculation for Progress tab using same approach as previous tabs
  - Progress tab is at index 3 (fourth tab) in the tab bar
  - Extended UI tests to verify all five tour steps including the new progress step
  - The implementation follows the existing pattern from Stories 20.3-20.4
  - All syntax checks pass successfully
  - Note: The Progress step currently has "Get Started" button as `isLastStep: true`, but this will need to be updated when Story 20.6 is implemented
- **Change Log:** 
  - Initial Draft - 2025-01-09
  - Implementation Complete - 2025-01-09