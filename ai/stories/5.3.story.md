# Story 5.3: Create Educational Resource Screen

**Status:** Draft

## Goal & Context

**User Story:** As an Admin/Content Creator, I want to create new educational articles, providing a title, content, category, and an optional visual, so that new learning materials can be made available to users.

**Context:** This story builds upon the educational resources feature (Epic 5). Story 5.1 established the listing view, and Story 5.2 implemented the detail view. This story introduces the functionality for content creators to add new resources to the system via a dedicated UI within the app (or an admin panel if specified).

## Detailed Requirements

- Design and implement a "Create Article" or "New Educational Resource" screen.
- This screen should provide input fields for:
    - Article Title (Text Input)
    - Full Article `contentText` (Text Area, potentially rich text if feasible for MVP)
    - `category` (Picker/Dropdown selecting from `ResourceCategory` enum values)
    - `visualPlaceholderUrl` (Text Input, optional)
- Implement form validation:
    - Title and `contentText` should not be empty.
    - `category` must be selected.
    - `visualPlaceholderUrl`, if provided, should be a valid URL format (basic check).
- On successful submission, the new `EducationalResource` should be saved to the `educationalResources` collection in Firestore.
    - A new unique `resourceId` should be generated (Firestore can do this automatically if no ID is provided when adding a document).
- After successful creation, navigate the user back to the Educational Resources listing screen (Story 5.1), where the new article should ideally appear (or after a refresh).
- Provide clear user feedback for submission success or failure (e.g., toast message, alert).

## Acceptance Criteria (ACs)

- AC1: A "Create Article" screen is accessible (e.g., via a '+' button on the Educational Resources List screen from Story 5.1).
- AC2: The screen provides input fields for title, content, category, and an optional visual URL.
- AC3: Form validation prevents submission of incomplete or invalid data (empty title/content, no category).
- AC4: Successfully submitting the form creates a new document in the `educationalResources` Firestore collection with the provided data and a unique ID.
- AC5: After successful creation, the user is navigated back to the resource list, and a success message is shown.
- AC6: If Firestore save fails, an appropriate error message is displayed to the user.
- AC7: The UI for the creation screen adheres to `docs/style-guide.md` and `docs/ui-ux-spec.md`.

## Technical Implementation Context

**Guidance:** Use the following details for implementation.

- **Relevant Files:**
  - Files to Create:
    - `Growth/Features/EducationalResources/Views/CreateEducationalResourceView.swift`
    - `Growth/Features/EducationalResources/ViewModels/CreateEducationalResourceViewModel.swift`
  - Files to Modify:
    - `Growth/Features/EducationalResources/Views/EducationalResourcesListView.swift` (to add navigation to the create screen, e.g., an "Add" button).
    - `Growth/Core/Services/FirestoreService.swift` (to add a function for creating/saving a new `EducationalResource`).

- **Key Technologies:**
  - SwiftUI for UI implementation.
  - Combine or async/await for form handling, validation, and data submission in the ViewModel.
  - Firebase Firestore for data persistence.

- **API Interactions / SDK Usage:**
  - Firebase Firestore SDK:
    - Add a new document to the `educationalResources` collection. Firestore can auto-generate document IDs.
      ```swift
      // Example: Adding a new document
      // let db = Firestore.firestore()
      // var ref: DocumentReference? = nil
      // ref = db.collection("educationalResources").addDocument(data: [
      //     "title": newResource.title,
      //     "contentText": newResource.contentText,
      //     "category": newResource.category.rawValue,
      //     "visualPlaceholderUrl": newResource.visualPlaceholderUrl ?? NSNull()
      //     // Firestore auto-generates the ID for 'ref.documentID'
      // ]) { err in
      //     if let err = err {
      //         print("Error adding document: \(err)")
      //     } else {
      //         print("Document added with ID: \(ref!.documentID)")
      //         // Update the local model's ID if needed: newResource.id = ref!.documentID
      //     }
      // }
      ```
    - Refer to `docs/data-models.md` for the `EducationalResource` model structure. The `id` field can be omitted when sending data to Firestore for creation if Firestore is to generate it. If you generate it client-side, ensure uniqueness.

- **UI/UX Notes:**
  - The screen should have a clear navigation bar title (e.g., "New Article").
  - Input fields should be clearly labeled and follow platform conventions (e.g., using `TextField`, `TextEditor`, `Picker`).
  - A "Save" or "Create" button should trigger the submission process.
  - Consider a "Cancel" button to discard changes and navigate back.
  - Loading indicators should be shown during submission.

- **Data Structures:**
  - Utilize the `EducationalResource` struct from `docs/data-models.md`. The ViewModel will manage an instance of this struct, populated by form inputs.
    ```swift
    // struct EducationalResource from docs/data-models.md
    // Ensure ResourceCategory enum is available and used for the picker.
    ```

- **Environment Variables:**
  - No new environment variables specific to this story are anticipated.

- **Coding Standards Notes:**
  - Follow general project coding standards.
  - Implement robust error handling for Firestore save operations.
  - Ensure ViewModel logic for form validation and submission is testable.
  - Input validation should provide user-friendly error messages next to the respective fields or in a summary area.

## Tasks / Subtasks

- [ ] Add a navigation mechanism (e.g., an "Add" button) in `EducationalResourcesListView.swift` to present `CreateEducationalResourceView`.
- [ ] Create `CreateEducationalResourceViewModel.swift`.
  - [ ] Define `@Published` properties for form fields (title, contentText, category, visualPlaceholderUrl).
  - [ ] Implement validation logic for these fields.
  - [ ] Define properties for loading state, error messages, and success state/navigation trigger.
  - [ ] Implement a function to save the new `EducationalResource` to Firestore using `FirestoreService`.
- [ ] Create `CreateEducationalResourceView.swift`.
  - [ ] Instantiate and use `CreateEducationalResourceViewModel`.
  - [ ] Build the form UI with `TextField` for title and URL, `TextEditor` for content, and `Picker` for category.
  - [ ] Bind UI elements to ViewModel properties.
  - [ ] Display validation errors.
  - [ ] Include "Save" and "Cancel" buttons.
  - [ ] Show loading indicators during submission.
  - [ ] Handle navigation upon successful save or cancellation.
- [ ] Update `FirestoreService.swift` to include a method like `addEducationalResource(_ resource: EducationalResource, completion: @escaping (Result<String, Error>) -> Void)`. The `String` in success can be the new document ID.
- [ ] Ensure UI adheres to `docs/style-guide.md` and `docs/ui-ux-spec.md`.
- [ ] Add unit tests for `CreateEducationalResourceViewModel` (form validation, Firestore interaction mocking).

## Testing Requirements

- **Unit Tests:**
  - Test `CreateEducationalResourceViewModel`:
    - Test form validation logic (e.g., empty fields, invalid URL).
    - Mock `FirestoreService` to simulate successful resource creation. Verify state changes and navigation trigger.
    - Simulate Firestore save error. Verify error state is published.
- **UI Tests (Manual for MVP):**
  - Navigate to the "Create Article" screen.
  - Attempt to submit an empty form; verify validation errors appear.
  - Fill out the form with valid data and submit.
    - Verify a success message is shown.
    - Verify navigation back to the resource list.
    - Verify the new article appears in the list (may require pull-to-refresh or real-time updates).
  - Test with an invalid visual URL (if strict validation is implemented).
  - Verify "Cancel" button functionality.

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Any notes about implementation choices, difficulties, or follow-up needed}
- **Change Log:**
  - Initial Draft by Gemini 2.5 Pro (YYYY-MM-DD) 