# Story 9.1: Define Progression Criteria in Method Data

**Status:** Draft

## Goal & Context

**User Story:** As a Content Admin/PM, I need to define clear, structured progression criteria for each Growth Method stage in Firestore, so the app can use this for readiness assessment.

**Context:** This story is the first step in Epic 9, which focuses on personalized user progression. By defining structured progression criteria in the Growth Method data model, we'll enable the app to track user readiness for progression between method stages. This foundational work will support future stories in this epic that develop algorithms to assess readiness and provide appropriate guidance to users.

## Detailed Requirements

- Extend the `growthMethods` data model in Firestore to include structured fields for progression criteria.
- Examples of criteria:
  - `minSessionsAtThisStage`: Minimum number of sessions to log for this method.
  - `minConsecutiveDaysPractice`: Minimum consecutive days of practice.
  - `subjectiveFeedbackRequirement`: e.g., User consistently reports "Good" or "Very Good" mood/experience post-session for X sessions.
  - `timeSpentAtStage`: Minimum total time spent practicing this method.
- Populate these criteria for all seeded Growth Methods.

## Acceptance Criteria (ACs)

- AC1: `growthMethods` model in Firestore includes fields for structured progression criteria.
- AC2: All seeded Growth Methods have their progression criteria defined in these fields.
- AC3: Criteria are clear and machine-readable where possible.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards and understand the project structure. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Modify: 
    - `Growth/Core/Models/GrowthMethod.swift` - Add structured progression criteria fields
    - `Growth/Core/Services/FirestoreService.swift` - Update methods for fetching/storing GrowthMethods
  - Files to Create:
    - `Growth/Core/Models/ProgressionCriteria.swift` - New model for structured progression criteria

- **Key Technologies:**

  - Swift & SwiftUI
  - Firebase/Firestore
  - Codable for model serialization/deserialization

- **API Interactions / SDK Usage:**

  - Firestore document updates
  - Firestore batch operations for updating multiple methods

- **Data Structures:**

  - New `ProgressionCriteria` model with the following properties:
    - `minSessionsAtThisStage`: Int
    - `minConsecutiveDaysPractice`: Int
    - `subjectiveFeedbackRequirement`: [String: Int] (e.g., ["Good": 3] means 3 "Good" sessions)
    - `timeSpentAtStage`: Int (in minutes)
    - `additionalCriteria`: [String: Any] (for method-specific criteria)
  
  - Modified `GrowthMethod` class:
    - Replace string-based `progressionCriteria` with structured `progressionCriteria: ProgressionCriteria?`

- **Environment Variables:**
  
  - No new environment variables needed

## Tasks / Subtasks

- [ ] Create a new `ProgressionCriteria` model
  - [ ] Define struct with codable conformance
  - [ ] Add appropriate initializers and helper methods
  - [ ] Include Firestore serialization/deserialization support
  
- [ ] Update `GrowthMethod` model
  - [ ] Replace string-based `progressionCriteria` with structured object
  - [ ] Update initializers and Firestore serialization/deserialization
  - [ ] Update `toDictionary()` method to include new structured progression criteria
  
- [ ] Update `FirestoreService`
  - [ ] Modify methods for saving/retrieving GrowthMethods to handle new structure
  - [ ] Create utility method to batch update existing methods (if needed)
  
- [ ] Add sample progression criteria for existing Growth Methods
  - [ ] Define appropriate criteria for each stage of each method
  - [ ] Create helper utility to apply these criteria to seeded methods

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:** 
  - Test serialization/deserialization of `ProgressionCriteria` model
  - Test conversion between Firestore document data and `GrowthMethod` objects with progression criteria
  
- **Manual Verification:**
  - Verify in Firebase console that all Growth Methods have structured progression criteria
  - Check that all required fields are correctly stored and retrievable

## Implementation Notes

The current implementation of `GrowthMethod` already has a `progressionCriteria` field, but it's a simple String. This story replaces that with a structured object to allow for programmatic evaluation of readiness criteria.

The existing logic in `FirestoreService` for reading/writing GrowthMethod documents will need to be updated to handle the new structured field.

When populating progression criteria, consider the appropriate values for each method stage:
- Early/beginner stages might have simpler criteria (e.g., complete 5 sessions)
- Advanced stages might have more complex criteria (e.g., 10 sessions with at least 7 consecutive days and "Good" or better mood feedback)

This implementation should be designed with future stories in mind, particularly the readiness tracking algorithm in Story 9.2 that will consume these criteria. 