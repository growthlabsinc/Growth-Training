# Story 13.4: Design and Develop "Recommended Routine(s)" Feature

**Status:** Draft

## Goal & Context

**User Story:** As a User, I want to be able to view and potentially follow a recommended training routine, so I have guidance on how to structure my practice throughout the week.

**Context:** This story builds upon the reclassification of Growth Methods (Story 13.1), Angio Pumping implementation (Story 13.2), and UI updates (Story 13.3). With the methods now properly defined and displayed, this story focuses on creating structured weekly routines that users can follow to optimize their practice. These recommended routines will provide clear guidance on which methods to use on which days, including rest days, based on official documentation and best practices.

## Detailed Requirements

- Analyze the routine described in `docs/Untitled 7.txt` ("Typical Week": HEAVY Day, Full Rest Day, Standard Day, SABER Day, S2S/Light Day [cite: 117]) and the "1on1off schedule" mentioned in `docs/Untitled 5.txt`[cite: 294].
- Define 1-2 "Recommended Routines" for the app (e.g., "Standard Growth Routine," "Advanced Vascularity Routine").
  - The "Standard Growth Routine" could be based on the 1on1off principle for the core Angion Methods.
  - **Note:** SABER and S2S are mentioned in `docs/Untitled 7.txt` [cite: 72, 97] but not in the Angion Method "COMPLETE LIST" (`docs/Untitled 5.txt`). For the purpose of *this app's defined Growth Methods*, routines should primarily focus on the Angion Methods from `docs/Untitled 5.txt`. SABER/S2S could be "Optional Additions" or part of educational content on complementary practices, rather than core scheduled methods *within the app's Angion Method progression flow*, unless clarified to include them as primary methods. For now, the routine will focus on the app's core methods.
- Design a new section in the app (e.g., "Routines" tab, or a subsection under "Resources" or "Dashboard") where users can view these recommended routines.
- For each routine, display:
  - Name of the routine.
  - Overall goal/description.
  - A weekly schedule template (e.g., Day 1: AM X, Day 2: Rest, Day 3: AM Y).
- Allow users to "select" a routine they wish to follow (this selection can be stored in their user profile).

## Acceptance Criteria (ACs)

- AC1: At least one "Recommended Routine" focusing on Angion Methods from `docs/Untitled 5.txt` is defined and available in the app.
- AC2: Users can view the details of recommended routines, including a weekly schedule template.
- AC3: Users can select a routine to follow, and this preference is saved.
- AC4: The design for presenting routines is clear and easy to understand.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. The developer should focus on both creating the data model for routines and implementing the UI to display and select routines.

- **Relevant Files:**

  - Files to Create:
    - `Growth/Core/Models/RoutineModel.swift` - New model for routine structure
    - `Growth/Features/Routines/Views/RoutinesListView.swift` - View for listing available routines
    - `Growth/Features/Routines/Views/RoutineDetailView.swift` - View for showing routine details
    - `Growth/Features/Routines/ViewModels/RoutinesViewModel.swift` - ViewModel for routines list
    - `Growth/Features/Routines/ViewModels/RoutineDetailViewModel.swift` - ViewModel for routine details
    - `Growth/Core/Services/RoutineService.swift` - Service for managing routines

  - Files to Modify:
    - `Growth/Core/Models/User.swift` - Add selectedRoutineId field
    - `Growth/Core/Services/UserService.swift` - Update to handle storing routine selection
    - `Growth/MainView.swift` - Add new Routines tab or update existing navigation
    - `Growth/Features/Dashboard/Views/DashboardView.swift` - Add routine section if using Dashboard approach

- **Key Technologies:**

  - SwiftUI for UI components
  - Combine framework for view model state management
  - Firebase Firestore for storing routines and user selections

- **API Interactions / SDK Usage:**

  - Firestore operations:
    - Create a new `routines` collection to store predefined routines
    - Update the user document to store their selected routine
    - Read routine data to display to users

- **Data Structures:**

  - Routine Model:
    ```swift
    struct Routine: Identifiable, Codable {
        var id: String
        var name: String
        var description: String
        var difficultyLevel: String // e.g., "Beginner", "Intermediate", "Advanced"
        var schedule: [DaySchedule]
        
        // Additional metadata
        var createdAt: Date
        var updatedAt: Date
    }
    
    struct DaySchedule: Identifiable, Codable {
        var id: String
        var dayNumber: Int // 1-7 for a week
        var dayName: String // e.g., "Day 1: Heavy Training"
        var description: String
        var methodIds: [String]? // For specific methods, nil for rest days
        var isRestDay: Bool
        var additionalNotes: String?
    }
    ```

  - User Model Update:
    ```swift
    // Add to existing User model
    var selectedRoutineId: String?
    ```

- **UI/UX Notes:**
  - Design a clean, calendar-style weekly view for the routine schedule
  - Use color coding to differentiate between training days and rest days
  - For each routine, provide an overview card and a detailed view
  - Create a clear "Select This Routine" action that confirms user selection
  - Consider adding a "Current Routine" section to the Dashboard for quick access

- **Coding Standards Notes:**
  - Follow existing UI patterns for consistency
  - Implement proper loading states and error handling
  - Ensure all new UI components are accessible
  - Keep routine definitions in Firestore rather than hardcoding, to allow for updates without app releases

## Tasks / Subtasks

- [ ] Define Data Models
  - [ ] Create the Routine and DaySchedule models
  - [ ] Update the User model to include selectedRoutineId

- [ ] Setup Firestore for Routines
  - [ ] Create routines collection with appropriate schema
  - [ ] Define at least one recommended routine based on the documentation
  - [ ] Create migration script to populate initial routines

- [ ] Create RoutineService
  - [ ] Implement methods to fetch all routines
  - [ ] Implement methods to fetch a specific routine by ID
  - [ ] Implement method to update user's selected routine

- [ ] Implement RoutinesViewModel
  - [ ] Add functionality to load all available routines
  - [ ] Add state management for loading, error, and success states
  - [ ] Implement routine selection functionality

- [ ] Create UI Components
  - [ ] Design and implement RoutinesListView
  - [ ] Design and implement RoutineDetailView
  - [ ] Design and implement RoutineScheduleView (for displaying weekly schedule)
  - [ ] Design and implement RoutineDayView (for displaying a specific day's activities)

- [ ] Integrate with App Navigation
  - [ ] Add Routines section to appropriate place in app (new tab or Dashboard section)
  - [ ] Update MainView if adding a new tab
  - [ ] Create navigation between routine list and detail views

- [ ] Implement User Selection
  - [ ] Add UI for selecting a routine
  - [ ] Store user selection in Firestore
  - [ ] Add visual indication of currently selected routine

- [ ] UI Polish and Testing
  - [ ] Add animations for transitions and selections
  - [ ] Implement proper error states and loading indicators
  - [ ] Test on multiple device sizes

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:** 
  - Test RoutineService methods for proper data fetching and user preference updates
  - Verify RoutinesViewModel properly handles various data states (loading, error, success)
  - Test data model serialization/deserialization

- **Integration Tests:** 
  - Test the full flow from browsing routines to selecting one
  - Verify that user preference is correctly saved and retrieved
  - Test navigation between routine list and detail views

- **Manual Verification:**
  - Verify all routines display correctly with their full schedule
  - Test routine selection process works as expected
  - Verify user preference persists across app restarts
  - Check that the UI is responsive on different device sizes
  - Verify that all text is properly sized and readable
  - Test accessibility features (VoiceOver compatibility, etc.)

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Any notes about implementation choices, difficulties, or follow-up needed}
- **Change Log:** {Track changes _within this specific story file_ if iterations occur}
  - Initial Draft
  - ... 