# Story 6.1: AI Chat Coach UI - Basic Chat Interface

**Status:** Draft

## Goal & Context

**User Story:** As a User, I want a simple chat interface where I can type questions and view responses from the AI Growth Coach.

**Context:**
This story is the first step in Epic 6, introducing the "Growth Coach" feature. It focuses on building the foundational UI for the chat experience, enabling users to interact with the AI Coach. The UI must be visually distinct, professional, and supportive, following the Growth app's style guide and UI/UX principles. This story does not include backend integration (see Story 6.2).

## Detailed Requirements

- Design and implement a "Coach" screen with a text input field for user queries and a scrollable view for displaying the conversation history (user messages and AI responses).
- User messages and AI responses should be visually distinct (e.g., different bubble colors/alignment).
- Conversation history should persist locally for the current session (full persistence TBD, could be Firestore based in future).
- UI adheres to `docs/style-guide.md` and `docs/ui-ux-spec.md` (calm, professional, supportive).
- Follow MVVM architecture as described in `docs/Frontend Architecture.md`.
- Use modular SwiftUI components for chat bubbles and input field.
- Ensure accessibility (AX) best practices: proper contrast, VoiceOver labels, and large touch targets.
- Prepare for future integration with AI backend (see Story 6.2) by structuring ViewModel and message model for easy extension.

## Acceptance Criteria (ACs)

- AC1: User can type a message into a text input field and send it.
- AC2: Sent messages and AI responses are displayed in a chat-like, scrollable view.
- AC3: Input field clears after sending a message.
- AC4: Basic UI styling is applied as per the style guide.
- AC5: Chat bubbles are visually distinct for user and AI.
- AC6: Conversation history persists for the current session (in-memory).
- AC7: UI is accessible (VoiceOver, color contrast, touch targets).

## Technical Implementation Context

**Guidance:**
Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/templates/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**
  - Files to Create:
    - `Growth/Features/Coach/Views/CoachChatView.swift` (main chat UI)
    - `Growth/Features/Coach/Views/MessageBubble.swift` (chat bubble component)
    - `Growth/Features/Coach/Models/ChatMessage.swift` (message model)
    - `Growth/Features/Coach/ViewModels/CoachChatViewModel.swift` (session state)
  - Files to Modify:
    - `Growth/MainView.swift` (add Coach tab if not present)
    - `Growth/Core/UI/Theme/` and `Growth/Core/UI/Components/` (if new components/styles are needed)

- **Key Technologies:**
  - SwiftUI (for UI)
  - MVVM pattern: View (CoachChatView), ViewModel (CoachChatViewModel), Model (ChatMessage)
  - Local state management with `@StateObject`/`@ObservedObject`
  - Use of custom SwiftUI components for chat bubbles and input field
  - Accessibility modifiers for VoiceOver and touch targets

- **API Interactions / SDK Usage:**
  - None for this story (no backend integration yet)

- **UI/UX Notes:**
  - Chat bubbles: User messages right-aligned, Core Green or Mint Green background; AI messages left-aligned, Pale Green or White background.
  - Input field: Styled per style guide (rounded, border, placeholder in Neutral Gray).
  - Scrollable chat history: Most recent messages at the bottom.
  - Calm, professional, supportive tone; avoid clutter.
  - See Figma reference in `docs/ui-ux-spec.md` for visual cues.
  - Use spacing, color, and typography tokens from `docs/style-guide.md`.
  - Ensure all interactive elements have a minimum 44pt touch target.

- **Data Structures:**
  - `ChatMessage` struct:
    - `id: UUID`
    - `text: String`
    - `sender: ChatSender` (enum: `.user`, `.ai`)
    - `timestamp: Date`
  - `CoachChatViewModel`:
    - `@Published var messages: [ChatMessage]`
    - `@Published var currentInput: String`
    - `func sendMessage()`

- **Environment Variables:**
  - None for this story

- **Coding Standards Notes:**
  - Follow standards in `docs/coding-standards.md`
  - Use theming and typography from `docs/style-guide.md`
  - Use spacing and color tokens as defined
  - Use MVVM as described in `docs/Frontend Architecture.md`
  - Comment code for clarity, especially for custom SwiftUI components

## Tasks / Subtasks

- [ ] Create `ChatMessage` model and `ChatSender` enum
- [ ] Create `CoachChatViewModel` to manage chat state and input
- [ ] Implement `CoachChatView.swift` with:
  - [ ] Scrollable chat history view
  - [ ] Distinct chat bubbles for user and AI (extract to `MessageBubble.swift`)
  - [ ] Text input field with send button
- [ ] Ensure input field clears after sending
- [ ] Apply style guide colors, typography, and spacing
- [ ] Add Coach tab to `MainView.swift` if not present
- [ ] Ensure accessibility (VoiceOver, color contrast, touch targets)
- [ ] Manual test: User can send messages, see them in chat, and UI matches style guide
- [ ] Prepare ViewModel and data model for future backend integration (Story 6.2)

## Testing Requirements

**Guidance:**
Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:**
  - Test that sending a message appends it to the chat history and clears the input field.
  - Test that messages are correctly attributed to user or AI and rendered with correct style.
  - Test that the ViewModel can be initialized and maintains state as expected.

- **Integration Tests:**
  - Test that the chat UI correctly displays a sequence of user and AI messages.
  - Test that the input field and send button are accessible and function as expected.

- **Manual/Exploratory Testing:**
  - Launch app, navigate to Coach tab, send messages, verify chat UI and styling.
  - Test with VoiceOver enabled for accessibility.
  - Test on both light and dark mode.
  - Test on different device sizes (iPhone SE, iPhone 15 Pro Max, iPad if supported).

- **Accessibility Testing:**
  - Use VoiceOver to verify all chat bubbles and input fields are labeled and navigable.
  - Check color contrast for chat bubbles and text.
  - Ensure all interactive elements meet 44pt minimum touch target.

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Any notes about implementation choices, difficulties, or follow-up needed}
- **Change Log:**
  - Initial Draft
  - Expanded with accessibility, architecture, and testing details 