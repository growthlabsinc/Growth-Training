# Story 9.2: Readiness Assessment Algorithm

## Goal & Context

**User Story:** As a User, I want to receive personalized recommendations about when I'm ready to progress to the next stage of a Growth Method, so I can advance at an appropriate pace for my individual journey.

**Context:** This story builds directly on the structured progression criteria defined in Story 9.1. Now that we have machine-readable criteria in our Growth Method data, we can implement an algorithm to assess user readiness for progression based on their activity history. This is a key component of Epic 9's focus on personalized user progression.

## Detailed Requirements

- Create a readiness assessment algorithm that evaluates a user's readiness to progress to the next stage
- Algorithm should evaluate each criterion from the `ProgressionCriteria` model against user's actual data:
  - Check if user has completed minimum required sessions at current stage
  - Verify streak/consecutive days practice requirement
  - Analyze mood/subjective feedback requirements
  - Calculate total time spent at current stage
  - Evaluate any additional method-specific criteria
- Implement interface to display readiness status on Method Detail screen
- Add readiness indicator on Dashboard for currently active method

## Acceptance Criteria (ACs)

- AC1: A service/utility class calculates user readiness based on structured progression criteria
- AC2: Method Detail screen displays user's current readiness status with specific progress towards each criterion
- AC3: Dashboard shows readiness indicator for active method when user is ready to progress
- AC4: Readiness status updates reactively when new sessions are logged or criteria change

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards and understand the project structure. Only story-specific details are included below.

- **Relevant Files:**

  - Files to Create: 
    - `Growth/Core/Services/ProgressionService.swift` - New service to assess user readiness
    - `Growth/Features/GrowthMethods/Views/ProgressionStatusView.swift` - Component to visualize readiness
  
  - Files to Modify:
    - `Growth/Features/GrowthMethods/Views/GrowthMethodDetailView.swift` - Add progression status
    - `Growth/Features/Dashboard/Views/DashboardView.swift` - Add readiness indicator
    - `Growth/Features/GrowthMethods/ViewModels/GrowthMethodDetailViewModel.swift` - Add progression logic

- **Key Technologies:**

  - Swift & SwiftUI
  - Combine for reactive updates
  - Firebase/Firestore for activity data

- **API Interactions / SDK Usage:**

  - Firestore queries to fetch user's session logs
  - Combine publishers for reactive updates

- **Data Structures:**

  - New ReadinessStatus enum:
    ```swift
    enum ReadinessStatus {
        case notReady
        case approaching
        case ready
        case exceeded
    }
    ```
  
  - ProgressionSnapshot struct to track progress towards criteria:
    ```swift
    struct ProgressionSnapshot {
        let currentSessions: Int
        let requiredSessions: Int?
        let currentConsecutiveDays: Int
        let requiredConsecutiveDays: Int?
        let moodRequirements: [String: (current: Int, required: Int)]?
        let currentTimeSpent: Int
        let requiredTimeSpent: Int?
        let overallStatus: ReadinessStatus
    }
    ```

- **Environment Variables:**
  
  - No new environment variables needed

## Tasks / Subtasks

- [ ] Create `ProgressionService` with core evaluation logic
  - [ ] Implement method to evaluate readiness based on criteria and user data
  - [ ] Create helper functions for each type of criteria (sessions, streaks, moods, time)
  - [ ] Design reactive update mechanism for when new sessions are logged

- [ ] Create `ProgressionStatusView` component
  - [ ] Design visual representation of progress towards each criterion
  - [ ] Implement different states/visuals for ReadinessStatus levels
  - [ ] Add appropriate accessibility labels and hints

- [ ] Update `GrowthMethodDetailViewModel`
  - [ ] Add properties and methods to track readiness status
  - [ ] Connect to ProgressionService for evaluation logic
  - [ ] Implement reactive updates when session data changes

- [ ] Update `GrowthMethodDetailView`
  - [ ] Add ProgressionStatusView to appropriate section
  - [ ] Ensure proper UI states for different readiness levels
  - [ ] Add relevant guidance text based on readiness status

- [ ] Update `DashboardView`
  - [ ] Add readiness indicator for active method
  - [ ] Implement conditional display logic for readiness status
  - [ ] Ensure consistent styling with rest of dashboard

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:** 
  - Test readiness evaluation logic with various criteria and mock user data
  - Verify correct ReadinessStatus results for different scenarios
  
- **Manual Verification:**
  - Log multiple sessions with different durations/moods and verify readiness status updates
  - Check that Dashboard indicator appears when ready to progress
  - Verify all UI elements display correctly for different readiness states

## Implementation Notes

The `ProgressionService` should be designed as a singleton that caches results where appropriate to minimize database reads. Consider using Combine to create a pipeline that:

1. Observes when new session logs are added
2. Triggers re-evaluation of readiness for affected method
3. Updates UI components reactively

For the UI, use a traffic light-inspired system:
- Red/Orange for not ready
- Yellow for approaching
- Green for ready
- Blue for exceeded (well beyond ready)

When a user is ready to progress, consider adding a congratulatory message using the `AffirmationService` from Story 8.5 to recognize their achievement. Use a category-specific message that acknowledges their progression readiness.

This implementation should be designed with future Story 9.3 in mind, which will handle the actual progression mechanism when a user chooses to advance to the next stage. 