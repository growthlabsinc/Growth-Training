# Story 13.1: Re-Define and Re-Classify Core Growth Methods

**Status:** Draft

## Goal & Context

**User Story:** As a Content Admin/PM, I need to update the `growthMethods` collection in Firestore to reflect the definitive list of methods from the provided documents (`Untitled 5.txt`), using the new classification: Beginner, Foundation, Intermediate, Expert, Master.

**Context:** The app currently contains an initial set of Growth Methods that need to be refined and reclassified according to the definitive documentation. This story focuses on restructuring the core content in Firestore to align with the official method hierarchy, ensuring users receive accurate, standardized information about each method's techniques, progression criteria, and safety considerations. This content overhaul serves as the foundation for subsequent implementation of recommended routines and enhanced user guidance features.

## Detailed Requirements

- Analyze `Untitled 5.txt` ("Angion Methods COMPLETE LIST") to identify the definitive methods and their details.
- Map these methods to the new classification:
  - **Beginner:** ANGION METHOD 1.0 (D CLASS from doc) [cite: 216]
  - **Foundation:** ANGION METHOD 2.0 (C CLASS from doc) [cite: 234]
  - **Intermediate:** ANGION METHOD 2.5 (JELQ 2.0) (B CLASS from doc) [cite: 250]
  - **Expert:** VASCION (A CLASS from doc) [cite: 267]
  - **Master:** ANGIO-WHEEL (S CLASS from doc) [cite: 280] (Note: LMC MkII can be mentioned as an advanced variant if appropriate under Angio-Wheel content).
- For each method, update/create entries in the `growthMethods` Firestore collection with:
  - New classification (Beginner, Foundation, etc.).
  - Accurate title.
  - Detailed description and technique based *only* on `Untitled 5.txt` and `Untitled 6.txt`.
  - Specific progression/graduation criteria as outlined in `Untitled 5.txt` (e.g., for AM 1.0: "maintain an erection for the full duration of a 30 minute... session and are able to easily palpate a pulse in your dorsal arteries" [cite: 233]).
  - Important safety notes and operational constraints (e.g., "DO NOT PERFORM... WHILE IN A SEATED POSITION" [cite: 189]).
  - Information on required tools (e.g., lubricant for AM 1.0[cite: 218], pump and ACE bandage for Angio Pumping[cite: 199, 200], Angio-Wheel device for Master level [cite: 285]).
- Remove any methods from Firestore that are not in this definitive list.

## Acceptance Criteria (ACs)

- AC1: The `growthMethods` collection in Firestore accurately reflects the methods from `Untitled 5.txt`, reclassified as Beginner, Foundation, Intermediate, Expert, Master.
- AC2: All method descriptions, techniques, progression criteria, and safety notes are updated based *only* on the provided `Untitled 5.txt` and `Untitled 6.txt` documents.
- AC3: Information on required tools for each method is clearly documented.
- AC4: Outdated or non-definitive methods are removed from the database.

## Technical Implementation Context

**Guidance:** Developer must understand the existing Firestore schema and ensure updates maintain compatibility with the current app. The content update should be performed carefully to prevent disruption to existing users.

- **Relevant Files:**
  - `Growth/Core/Models/GrowthMethod.swift` - Contains the Swift model for growth methods
  - `Growth/Core/Services/FirestoreService.swift` - Contains methods for interacting with Firestore
  - `Growth/Features/GrowthMethods/Views/GrowthMethodsListView.swift` - View affected by changes
  - `Growth/Features/GrowthMethods/Views/GrowthMethodDetailView.swift` - View affected by changes
  - `Growth/Features/GrowthMethods/ViewModels/GrowthMethodsViewModel.swift` - May need updates if classification field affects filtering/sorting
  - New file: `scripts/method-migration.js` - Create a script for batch migration of method data

- **Key Technologies:** 
  - Firebase Firestore
  - Swift (for model updates)
  - Node.js with Firebase Admin SDK (for migration script)

- **API Interactions / SDK Usage:**
  - Firebase Firestore operations:
    - Read existing methods using `FirestoreService.shared.db.collection("growthMethods")`
    - Create/update methods using `setData()` or batch operations
    - Delete methods using `delete()`
  - Firebase Admin SDK for batch operations (recommended for this migration)

- **UI/UX Notes:**
  - No direct UI changes in this story, but content changes will affect what's displayed in method list and detail screens
  - Ensure method descriptions are formatted properly for display with appropriate line breaks and formatting

- **Data Structures:**
  - Existing `GrowthMethod` model already contains many needed fields:
    ```swift
    class GrowthMethod: NSObject, Codable, Identifiable, NSSecureCoding {
        @DocumentID var id: String?
        var stage: Int                   // This will likely map to classification order
        var title: String
        var methodDescription: String
        var instructionsText: String
        var visualPlaceholderUrl: String?
        var equipmentNeeded: [String]
        var estimatedDurationMinutes: Int?
        var categories: [String]
        var isFeatured: Bool
        var progressionCriteriaText: String?
        var progressionCriteria: ProgressionCriteria?
        var safetyNotes: String?
        var benefits: [String]?
        var relatedMethods: [String]?
        var timerConfig: TimerConfiguration?
        var createdAt: Date
        var updatedAt: Date
    }
    ```
  - Add a new "classification" field to the Firestore documents to store values like "Beginner", "Foundation", etc.
  - Use the existing `progressionCriteriaText` for full text criteria and `safetyNotes` for safety warnings
  - Use the existing `equipmentNeeded` array for required tools

- **Environment Variables:** 
  - For migration script: Set `GOOGLE_APPLICATION_CREDENTIALS` to service account JSON file path

## Tasks / Subtasks

- [ ] Review and analyze source documents
  - [ ] Thoroughly read `Untitled 5.txt` to extract detailed method information
  - [ ] Create structured summaries for each method (Beginner through Master)
  - [ ] Document required tools, safety warnings, and progression criteria for each
- [ ] Plan database changes
  - [ ] Check if `GrowthMethod` model needs updates
  - [ ] Define mapping strategy from old to new classification system
  - [ ] Determine how to handle methods not in the official list
- [ ] Set up migration environment
  - [ ] Create a Node.js project for the migration script
  - [ ] Configure Firebase Admin SDK with service account credentials
  - [ ] Add backup logic to export existing data before modification
- [ ] Develop migration script
  - [ ] Create data templates for each method based on source documents
  - [ ] Write code to read existing methods from Firestore
  - [ ] Implement logic to update existing methods or create new ones
  - [ ] Add functionality to remove methods not in the official list
  - [ ] Build in validation and error handling
- [ ] Test migration strategy
  - [ ] Test script against a development Firestore instance first
  - [ ] Verify all data is correctly formatted and complete
  - [ ] Check for any potential issues with existing app functionality
- [ ] Execute migration
  - [ ] Create full backup of existing method data
  - [ ] Run migration against production Firestore
  - [ ] Verify all methods were correctly updated
- [ ] Update documentation
  - [ ] Document the new method classification system
  - [ ] Update any relevant technical documentation

## Testing Requirements

- **Manual Testing:**
  - Verify all methods appear correctly in Firestore console with proper fields and values
  - Check that all required fields are populated for each method
  - Confirm removed methods no longer exist in the database
  - Use the app to view updated content in GrowthMethodsListView and GrowthMethodDetailView

- **Data Validation:**
  - Ensure all citations from source documents are accurately represented in the content
  - Verify all safety warnings are prominently included
  - Check that progression criteria are accurately documented
  - Verify required tools are correctly listed for each method

- **Regression Testing:**
  - Ensure existing app screens (GrowthMethodsListView, GrowthMethodDetailView) function with updated data
  - Check that method filtering and sorting still work if affected by classification changes
  - Verify user progression data is not adversely affected by content changes

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** 
- **Change Log:**
  - Initial Draft 