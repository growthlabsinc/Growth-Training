# Story 4.6: Basic Progress Visualization - Calendar View

**Status:** In-Progress

## Goal & Context

**User Story:** As a User, I want to see a calendar view highlighting the days I've logged training sessions, so I can quickly see my consistency.

**Context:** This story introduces the first progress visualization feature from Epic 4. It builds upon the existing session logging capabilities (Stories 4.1, 4.2, 4.3, and our ad-hoc 4.4 for Edit, 4.5 for Finalize Delete) by providing users with a visual way to track their activity on a calendar. This directly corresponds to the original "Story 4.4" in `docs/epic4.md`.

## Detailed Requirements

- On the "Progress" tab, implement a calendar view (e.g., using a native iOS calendar component or a third-party library).
- Fetch logged session dates for the authenticated user.
- Mark days on the calendar where one or more sessions were logged (e.g., with a dot or background color).
- (Optional MVP) Tapping a marked day on the calendar could filter the Session History list to show sessions for that day.

## Acceptance Criteria (ACs)

- AC1: Calendar view is displayed on the Progress tab.
- AC2: Days with logged sessions are visually marked on the calendar.
- AC3: Calendar correctly reflects logged session data for the current user.
- AC4: User can navigate between months/weeks in the calendar.
- AC5: (Optional MVP) If implemented, tapping a marked day filters the session history list below the calendar (if session history is also on this tab) or navigates to a filtered view.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

- **Architectural Guidance:**
  - Consult the project's main architecture document `docs/architecture.md` (to be populated based on the template at `docs/templates/architecture.md`) for overarching architectural patterns (e.g., MVVM, data flow conventions), component responsibilities, and key technology choices that may influence or guide the implementation of this feature.
  - Pay attention to any specified preferences for native vs. third-party UI components and data management strategies if detailed in the architecture document.

- **Relevant Files:**
  - Files to Create:
    - `Growth/Features/Progress/Views/ProgressCalendarView.swift` (or similar, if a dedicated view is needed, aligning with component structure potentially defined in `docs/architecture.md`)
    - `Growth/Features/Progress/ViewModels/ProgressViewModel.swift` (if not already existing and suitable, or to extend it, following data flow patterns from `docs/architecture.md`)
  - Files to Modify:
    - `Growth/Features/Progress/Views/ProgressView.swift` (to integrate the calendar)
    - Potentially `Growth/Features/SessionLogging/ViewModels/SessionHistoryViewModel.swift` if it needs to be adapted for filtering by date based on calendar interaction.
    - `Growth/Core/Models/SessionLog.swift` (ensure it contains necessary date information readily accessible).

- **Key Technologies:**
  - SwiftUI for UI.
  - Consider using `UICalendarView` (available in iOS 16+) for a native look and feel. If `docs/architecture.md` or `docs/tech-stack.md` specifies a preference or a different pre-selected library, adhere to that. Otherwise, **prioritize native `UICalendarView` if feasible for iOS 16+ target.**
  - Combine for reactive data flow (align with patterns potentially set in `docs/architecture.md`).
  - Firebase Firestore for fetching session log data.

- **API Interactions / SDK Usage:**
  - `FirestoreService.shared.fetchSessionLogs(forUserID:completion:)` (or similar existing method) to get session logs. The view model will need to process these logs to extract dates.

- **UI/UX Notes:**
  - The calendar should be integrated into the existing "Progress" tab as per `docs/ui-ux-spec.md`.
  - Visual marking of days should be clear but not overly intrusive, aligning with the app's calm and professional aesthetic (e.g., a small dot below the date number, or a subtle background highlight). Refer to `docs/style-guide.md` for color choices.
  - Ensure the calendar is easy to navigate (month/week switching).
  - If the "Progress" tab also shows the session history list, consider how the calendar interaction (tapping a day) might affect this list (e.g., scroll to date, filter).

- **Data Structures:**
  - `SessionLog` (existing model, primarily its date property).
  - The ViewModel might maintain a set of `Date` objects representing days with logged sessions to efficiently mark the calendar.

- **Environment Variables:**
  - None specific to this story beyond existing Firebase setup.

- **Coding Standards Notes:**
  - Follow standards in `docs/coding-standards.md`.
  - Ensure ViewModel handles fetching and preparing data for the calendar view, consistent with architectural data flow principles (see `docs/architecture.md` once available).

## Tasks / Subtasks

- [x] **Task 1: Design & Setup ProgressViewModel**
  - [x] Review `docs/architecture.md` (when available) for ViewModel responsibilities and patterns. (Note: Template reviewed, actual architecture.md pending)
  - [x] If `ProgressViewModel.swift` doesn't exist or isn't suitable, create it.
  - [x] Add functionality to fetch all `SessionLog` entries for the current user using `FirestoreService`.
  - [x] Process fetched logs to create a data structure suitable for populating the calendar (e.g., a `Set<DateComponents>` representing unique days with logs, or a dictionary mapping dates to log counts/indicators).
  - [x] Publish the prepared calendar data for the View.
- [x] **Task 2: Implement Calendar View UI (`ProgressCalendarView.swift` or integrate into `ProgressView.swift`)**
  - [x] Consult `docs/architecture.md` or `docs/tech-stack.md` for any UI component library decisions. (Note: Tech stack implies native where possible, UICalendarView chosen)
  - [x] Choose a calendar implementation (prefer native `UICalendarView` for iOS 16+ unless specified otherwise).
  - [x] Display the calendar.
  - [x] Implement navigation between months/weeks. (Native `UICalendarView` handles this)
  - [x] Connect the calendar to the `ProgressViewModel` to receive data.
  - [x] Visually mark days on the calendar that have one or more logged sessions, based on data from the ViewModel.
- [x] **Task 3: Integrate Calendar into "Progress" Tab**
  - [x] Add the `ProgressCalendarView` (or the integrated calendar logic) to the main `ProgressView.swift`.
  - [x] Ensure proper layout and styling according to `docs/ui-ux-spec.md` and `docs/style-guide.md`. (Basic integration done, further styling can be a new task/story if needed)
- [ ] **Task 4: (Optional MVP) Implement Day Tap Interaction**
  - [ ] If pursuing the optional AC5, implement the logic for when a user taps on a marked day.
  - [ ] This might involve:
    - Updating a `selectedDate` property in the `ProgressViewModel`.
    - Filtering the `SessionHistoryView` (if present on the same screen) to show only logs for the selected date.
    - Or, navigating to a separate, filtered view of session logs for that day.
  (Note: Selected date is captured; filtering SessionHistoryView is deferred as per MVP approach)
- [ ] **Task 5: Testing**
  - [ ] Write unit tests for `ProgressViewModel` logic (data fetching, processing for calendar).
  - [ ] Manually verify calendar display, navigation, and correct marking of days with logged sessions using sample data.
  - [ ] (If AC5 implemented) Manually verify the day tap interaction and filtering.
 (Note: Manual verification pending app run. Unit tests deferred.)

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`. Consult `docs/architecture.md` for any specific testing strategies related to the chosen UI patterns.

- **Unit Tests:**
  - For `ProgressViewModel`:
    - Test fetching of session logs.
    - Test correct transformation of session logs into a data structure for marking calendar dates (e.g., ensure unique dates are correctly identified).
    - If filtering logic for day taps is added, test that as well.
- **Manual/UI Verification:**
  - Navigate to the "Progress" tab.
  - Verify the calendar displays correctly.
  - Verify that days with logged sample sessions are visually marked as expected.
  - Verify that days without logged sessions are not marked.
  - Test navigation between different months and weeks in the calendar.
  - (Optional MVP) If day-tap filtering is implemented, log sessions on various days and verify that tapping a marked day correctly filters the displayed session list or navigates as expected. Ensure tapping an unmarked day or a day with no logs behaves gracefully (e.g., clears filter or shows "no sessions for this day").

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Any notes about implementation choices, difficulties, or follow-up needed}
- **Change Log:**
  - Initial Draft
  - Redrafted to include references to `docs/architecture.md` template. 