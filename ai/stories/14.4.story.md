# Story 14.4: Upgraded Streak Tracking & Progress Visualization

**Status:** Draft

## Goal & Context

**User Story:** As a User, I want enhanced streak tracking with richer visual feedback and improved progress visualization, making it more motivating to maintain my daily practice routine.

**Context:**
This story continues the UI modernization effort of Epic 14, building on the previous visual design refresh (14.1), layout modernization (14.2), and navigation/calendar improvements (14.3). It focuses specifically on enhancing the streak tracking feature and related visualizations to increase user engagement and motivation. By providing more visually appealing and informative streak tracking, users will be more motivated to maintain their practice routines.

## Detailed Requirements

- **Enhanced Streak Visualization:**
  - Redesign the streak counter on the dashboard with animated flame icons that increase in size/intensity based on streak length.
  - Implement a streak calendar view showing the last 30 days of activity with color-coded indicators.
  - Add micro-animations for streak milestones (e.g., flame "explosion" when reaching 7, 14, 30 days).
  - Create a visual "streak at risk" indicator with subtle animation to increase urgency.
  
- **Progress Timeline Visualization:**
  - Add a visual timeline showing practice consistency over the past week/month.
  - Implement a heat map visualization showing practice frequency and duration.
  - Create interactive charts showing progress trends over time.
  - Add visual milestone markers to highlight significant achievements.

- **Motivational Elements:**
  - Design "next milestone" preview to show upcoming achievements.
  - Add contextual motivational messages based on current streak status.
  - Implement streak sharing functionality with customizable sharing cards.

## Acceptance Criteria (ACs)

- AC1: Dashboard displays enhanced streak counter with flame icon that visually represents streak length.
- AC2: StreakStatsView includes a 30-day calendar visualization of practice history.
- AC3: Reaching streak milestones (7, 14, 30 days) triggers appropriate micro-animations.
- AC4: Streak timeline shows practice consistency with appropriate visualizations for frequency and duration.
- AC5: "Streak at risk" status is clearly indicated with visual urgency cues.
- AC6: Users can see upcoming milestone previews with clear indication of requirements.
- AC7: Users can generate and share streak achievement cards.

## Technical Implementation Context

**Guidance:** Follow standards in [`docs/style-guide.md`](mdc:docs/style-guide.md) and [`docs/ui-ux-spec.md`](mdc:docs/ui-ux-spec.md). Reference the Figma design for visual cues. Only story-specific details are included below.

- **Relevant Files:**
  - Files to Modify:
    - `Growth/Features/Dashboard/Views/DashboardView.swift` (enhance streak display section)
    - `Growth/Features/Stats/Views/StreakStatsView.swift` (add calendar and timeline visualizations)
    - `Growth/Features/Stats/ViewModels/StreakStatsViewModel.swift` (add data for visualizations)
    - `Growth/Features/Notifications/StreakTracker.swift` (enhance streak tracking capabilities)
  - Files to Create:
    - `Growth/Core/UI/Components/StreakCalendarView.swift` (new calendar visualization)
    - `Growth/Core/UI/Components/PracticeTimelineView.swift` (new timeline visualization)
    - `Growth/Core/UI/Components/StreakSharingCard.swift` (for sharing functionality)
    - `Growth/Features/Stats/Models/StreakCalendarData.swift` (data model for calendar)

- **Key Technologies:**
  - SwiftUI (for UI components and animations)
  - Combine (for reactive data updates)
  - Core Animation (for complex animations)
  - UIActivityViewController (for sharing)

- **API Interactions / SDK Usage:**
  - Firebase Firestore (to fetch and update streak data)

- **UI/UX Notes:**
  - Streak Counter Styling:
    - Flame icon: Use SF Symbol "flame.fill" with size variation based on streak length
    - Base size: 28pt for new streaks, +2pt for each week (capped at 48pt)
    - Colors: Orange (1-6 days), Red (7-29 days), Purple (30+ days)
    - Counter font: Bold, 24-28pt, with matching color scheme
  - Calendar Visualization:
    - 30-day grid (5Ã—6) with today highlighted
    - Color coding: Empty (no practice), Green gradient (practice duration)
    - Day indicators: Small circles with subtle gradient
    - Current day: Larger circle with pulsing animation
  - Timeline Visualization:
    - X-axis: Last 7 days or 30 days (switchable)
    - Y-axis: Practice duration in minutes
    - Bars or line graph with gradient fill
    - Color: "GrowthGreen" gradient
  - "At Risk" Styling:
    - Pulsing red outline around streak counter
    - Warning icon with subtle shake animation
    - Time remaining indicator with countdown style

- **Data Structures:**
  - StreakCalendarData (new model):
    - Date-indexed dictionary of practice sessions
    - Duration, status (completed, missed, rest day)
    - Aggregated statistics for visualizations

- **Environment Variables:**
  - None required for this story.

- **Coding Standards Notes:**
  - Follow standards in [`docs/style-guide.md`](mdc:docs/style-guide.md) and [`docs/templates/coding-standards.md`](mdc:docs/templates/coding-standards.md).
  - Reference [`docs/ui-ux-spec.md`](mdc:docs/ui-ux-spec.md) for visual/interaction details.

## Tasks / Subtasks

- [ ] Enhance streak counter in DashboardView with size-variable flame icon and animations
- [ ] Create StreakCalendarView component showing 30-day practice history
- [ ] Implement milestone animations for significant streak achievements
- [ ] Design and implement PracticeTimelineView for consistency visualization
- [ ] Add "streak at risk" visual indicators with appropriate animations
- [ ] Create "next milestone" preview UI elements
- [ ] Implement streak sharing functionality with customizable sharing cards
- [ ] Extend StreakTracker to support additional data needed for new visualizations
- [ ] Update StreakStatsViewModel to provide data for new visualization components
- [ ] Update StreakStatsView to incorporate new visualization components
- [ ] Add contextual motivational messages based on streak status
- [ ] Test all changes on device and simulator for both light and dark mode

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in [`docs/Testing Strategy Documentation.md`](mdc:docs/Testing%20Strategy%20Documentation.md).

- **Unit Tests:**
  - Test streak calculation logic and milestone detection
  - Test calendar data transformation for visualization
  - Test timeline data aggregation functions
- **Manual/CLI Verification:**
  - Verify streak counter appearance at different streak lengths (0, 3, 7, 14, 30+)
  - Check milestone animations trigger at appropriate streak counts
  - Validate calendar visualization shows correct practice history
  - Confirm "streak at risk" indicators appear appropriately
  - Test sharing functionality generates correct images/content
  - Verify all visualizations update correctly when streak changes
  - Test in both light and dark mode
  - Validate accessibility (VoiceOver, color contrast)

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** <Agent Model Name/Version>
- **Completion Notes:**
- **Change Log:**
  - Initial Draft

---

# Story Draft Checklist Summary

| Category                             | Status  | Issues |
| ------------------------------------ | ------- | ------ |
| 1. Goal & Context Clarity            | PASS    |        |
| 2. Technical Implementation Guidance | PASS    |        |
| 3. Reference Effectiveness           | PASS    |        |
| 4. Self-Containment Assessment       | PASS    |        |
| 5. Testing Guidance                  | PASS    |        |

**Final Assessment:**
- READY: The story provides sufficient context for implementation 